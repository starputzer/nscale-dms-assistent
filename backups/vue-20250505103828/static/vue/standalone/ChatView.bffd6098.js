import{e as X,_ as T,f as k,g as $,o as j,w as N,b as u,c as d,h as e,i as M,F as H,p as O,n as D,t as C,u as P,j as y,l as me,q as z,v as Y,y as J,m as U,d as V,G as R}from"./_plugin-vue_export-helper.89064427.js";import{a as I}from"./authStore.ca6a9c68.js";import{u as ge}from"./motdStore.0cc12f6a.js";import{m as K,p as he}from"./purify.es.54938489.js";const E=X("session",{state:()=>({sessions:[],currentSessionId:null,loading:!1,error:null,pollInterval:null}),getters:{currentSession:s=>s.currentSessionId&&s.sessions.find(i=>i.id===s.currentSessionId)||null,sortedSessions:s=>[...s.sessions].sort((i,n)=>new Date(n.updated_at||n.created_at)-new Date(i.updated_at||i.created_at))},actions:{async fetchSessions(){var s,i;this.loading=!0,this.error=null;try{const n=await I.get("/api/sessions");this.sessions=n.data.sessions||[],this.sessions.length>0&&!this.currentSessionId&&this.setCurrentSession(this.sessions[0].id)}catch(n){console.error("Fehler beim Laden der Sessions:",n),this.error=((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.detail)||"Fehler beim Laden der Sessions"}finally{this.loading=!1}},async createSession(s="Neue Unterhaltung"){var i,n;this.loading=!0,this.error=null;try{const o=await I.post("/api/session",{title:s}),a={id:o.data.session_id,title:o.data.title,created_at:new Date().toISOString(),messages:[]};return this.sessions.unshift(a),this.setCurrentSession(a.id),a.id}catch(o){return console.error("Fehler beim Erstellen einer neuen Session:",o),this.error=((n=(i=o.response)==null?void 0:i.data)==null?void 0:n.detail)||"Fehler beim Erstellen einer neuen Session",null}finally{this.loading=!1}},async setCurrentSession(s){if(s===this.currentSessionId)return;this.currentSessionId=s;const i=this.sessions.find(n=>n.id===s);i&&(!i.messages||i.messages.length===0)&&await this.fetchSessionHistory(s)},async deleteSession(s){var i,n,o;this.loading=!0,this.error=null;try{return await I.delete(`/api/session/${s}`),this.sessions=this.sessions.filter(a=>a.id!==s),this.currentSessionId===s&&(this.currentSessionId=((i=this.sessions[0])==null?void 0:i.id)||null),!0}catch(a){return console.error("Fehler beim Löschen der Session:",a),this.error=((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.detail)||"Fehler beim Löschen der Session",!1}finally{this.loading=!1}},async renameSession(s,i){var n,o;this.loading=!0,this.error=null;try{await I.put("/api/session/rename",{session_id:s,title:i});const a=this.sessions.find(l=>l.id===s);return a&&(a.title=i),!0}catch(a){return console.error("Fehler beim Umbenennen der Session:",a),this.error=((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.detail)||"Fehler beim Umbenennen der Session",!1}finally{this.loading=!1}},async fetchSessionHistory(s){var i,n;this.loading=!0,this.error=null;try{const o=await I.get(`/api/session/${s}`),a=this.sessions.findIndex(l=>l.id===s);return a!==-1&&(this.sessions[a]={...this.sessions[a],title:o.data.title,messages:o.data.messages||[]}),o.data.messages||[]}catch(o){return console.error("Fehler beim Laden des Session-Verlaufs:",o),this.error=((n=(i=o.response)==null?void 0:i.data)==null?void 0:n.detail)||"Fehler beim Laden des Session-Verlaufs",[]}finally{this.loading=!1}},async updateSessionTitle(s){try{const i=await I.post(`/api/session/${s}/update-title`),n=this.sessions.find(o=>o.id===s);return n&&i.data.new_title&&(n.title=i.data.new_title),!0}catch(i){return console.error("Fehler beim Aktualisieren des Session-Titels:",i),!1}},clearStore(){this.sessions=[],this.currentSessionId=null,this.loading=!1,this.error=null,this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)},startSessionPolling(s=3e4){this.pollInterval&&clearInterval(this.pollInterval),this.pollInterval=setInterval(()=>{this.fetchSessions()},s)},stopSessionPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}}}),q=X("chat",{state:()=>({loading:!1,sending:!1,streaming:!1,streamController:null,currentQuestion:"",currentAnswer:"",pendingQuestion:"",error:null,currentFeedback:{messageId:null,isPositive:null,comment:""},useSimpleLanguage:!1,useStreaming:!0,showExplanation:!1,currentExplanation:null,showFeedbackDialog:!1,showSourcesDialog:!1,selectedSource:null,pendingMessages:[]}),getters:{isProcessing:s=>s.sending||s.streaming||s.loading,currentSources:s=>{const n=E().currentSession;if(!n)return[];const o=[...n.messages].reverse().find(a=>!a.is_user);return!o||!o.sources?[]:o.sources},hasActiveChats:()=>E().sessions.length>0},actions:{setQuestion(s){this.pendingQuestion=s,this.currentFeedback={messageId:null,isPositive:null,comment:""}},async sendQuestion(s=null){var c,r;const i=s||this.pendingQuestion;if(!i.trim())return;this.sending=!0,this.error=null,this.currentQuestion=i,this.pendingQuestion="";const n=E();let o=n.currentSessionId;if(!o&&(o=await n.createSession(),!o)){this.error="Fehler beim Erstellen einer neuen Session",this.sending=!1;return}const a={id:Date.now(),session_id:o,message:i,is_user:!0,created_at:new Date().toISOString()},l=n.sessions.find(t=>t.id===o);l?(l.messages||(l.messages=[]),l.messages.push(a)):this.pendingMessages.push(a);try{if(this.useStreaming)await this.startStreaming(i,o);else{const t=await I.post("/api/question",{question:i,session_id:o},{headers:{"X-Use-Simple-Language":this.useSimpleLanguage?"true":"false"}}),{answer:m,message_id:g,sources:x}=t.data,_={id:g,session_id:o,message:m,is_user:!1,created_at:new Date().toISOString(),sources:x||[]};l?l.messages.push(_):this.pendingMessages.push(_),(l==null?void 0:l.messages.length)<=2&&await n.updateSessionTitle(o)}}catch(t){console.error("Fehler beim Senden der Frage:",t),this.error=((r=(c=t.response)==null?void 0:c.data)==null?void 0:r.detail)||"Fehler beim Senden der Frage";const m={id:-Date.now(),session_id:o,message:`Fehler: ${this.error}`,is_user:!1,is_error:!0,created_at:new Date().toISOString()};l?l.messages.push(m):this.pendingMessages.push(m)}finally{this.sending=!1}},async startStreaming(s,i){this.streaming=!0,this.currentAnswer="";try{const n=new URLSearchParams({question:s,session_id:i,simple_language:this.useSimpleLanguage?"true":"false"});this.streamController=new AbortController;const{signal:o}=this.streamController,a=localStorage.getItem("auth_token"),l=new EventSource(`/api/question/stream?${n}`);let c="",r=null,t=[];l.onmessage=m=>{try{if(!m.data||m.data==="[DONE]")return;const g=JSON.parse(m.data);if(g.error){this.error=g.error,l.close(),this.streaming=!1;return}g.token&&(c+=g.token,this.currentAnswer=c),g.message_id&&(r=g.message_id),g.sources&&(t=g.sources)}catch(g){console.error("Fehler beim Verarbeiten der Streaming-Antwort:",g)}},l.addEventListener("done",()=>{if(l.close(),this.streaming=!1,c){const m=E(),g=m.sessions.find(_=>_.id===i),x={id:r||Date.now(),session_id:i,message:c,is_user:!1,created_at:new Date().toISOString(),sources:t||[]};g?(g.messages||(g.messages=[]),g.messages.push(x)):this.pendingMessages.push(x),(g==null?void 0:g.messages.length)<=2&&m.updateSessionTitle(i)}}),l.onerror=m=>{console.error("EventSource-Fehler:",m),l.close(),this.streaming=!1,this.error="Verbindungsfehler beim Streaming der Antwort"},o&&o.addEventListener("abort",()=>{l.close(),this.streaming=!1})}catch(n){console.error("Fehler beim Streaming-Start:",n),this.error="Fehler beim Starten des Antwort-Streams",this.streaming=!1}},cancelStreaming(){if(!(!this.streaming||!this.streamController))try{this.streamController.abort(),this.streamController=null}catch(s){console.error("Fehler beim Abbrechen des Streamings:",s)}},async loadExplanation(s){var i,n;this.loading=!0,this.error=null;try{const o=await I.get(`/api/explain/${s}`);this.currentExplanation=o.data,this.showExplanation=!0}catch(o){console.error("Fehler beim Laden der Erklärung:",o),this.error=((n=(i=o.response)==null?void 0:i.data)==null?void 0:n.detail)||"Fehler beim Laden der Erklärung"}finally{this.loading=!1}},showSourceDetails(s){this.selectedSource=s,this.showSourcesDialog=!0},async sendFeedback(s,i,n,o=""){var a,l;this.loading=!0,this.error=null;try{return await I.post("/api/feedback",{message_id:s,session_id:i,is_positive:n,comment:o}),this.currentFeedback={messageId:s,isPositive:n,comment:o},this.showFeedbackDialog=!1,!0}catch(c){return console.error("Fehler beim Senden des Feedbacks:",c),this.error=((l=(a=c.response)==null?void 0:a.data)==null?void 0:l.detail)||"Fehler beim Senden des Feedbacks",!1}finally{this.loading=!1}},prepareFeedback(s,i){this.currentFeedback={messageId:s,sessionId:i,isPositive:null,comment:""},this.showFeedbackDialog=!0},setSimpleLanguage(s){this.useSimpleLanguage=!!s,localStorage.setItem("use_simple_language",s?"true":"false")},setStreaming(s){this.useStreaming=!!s,localStorage.setItem("use_streaming",s?"true":"false")},loadSettings(){const s=localStorage.getItem("use_simple_language"),i=localStorage.getItem("use_streaming");s!==null&&(this.useSimpleLanguage=s==="true"),i!==null&&(this.useStreaming=i==="true")},clearStore(){if(this.loading=!1,this.sending=!1,this.streaming=!1,this.currentQuestion="",this.currentAnswer="",this.pendingQuestion="",this.error=null,this.currentFeedback={messageId:null,isPositive:null,comment:""},this.showExplanation=!1,this.currentExplanation=null,this.showFeedbackDialog=!1,this.showSourcesDialog=!1,this.selectedSource=null,this.pendingMessages=[],this.streamController){try{this.streamController.abort()}catch(s){console.error("Fehler beim Abbrechen des Streamings:",s)}this.streamController=null}}}});const fe={class:"session-list"},ve={key:0,class:"loading-state"},pe={key:1,class:"empty-state"},Se={key:2,class:"sessions"},be=["onClick"],ye={class:"session-title-container"},ke={class:"session-title"},_e=["onClick"],we={key:3,class:"delete-modal"},Ce={class:"modal-content"},$e={class:"modal-actions"},xe={__name:"SessionList",props:{currentSessionId:{type:Number,default:null}},emits:["session-selected","session-created","session-deleted"],setup(s,{emit:i}){const n=s,o=i,a=E(),l=k(!1),c=k(null),r=$(()=>a.sessions),t=$(()=>a.sortedSessions),m=$(()=>a.loading),g=p=>{p!==n.currentSessionId&&(a.setCurrentSession(p),o("session-selected",p))},x=async()=>{const p=await a.createSession();p&&o("session-created",p)},_=p=>{c.value=p,l.value=!0},b=async()=>{if(!c.value)return;await a.deleteSession(c.value)&&o("session-deleted",c.value),l.value=!1,c.value=null};return j(async()=>{await a.fetchSessions(),a.startSessionPolling()}),N(()=>a.sessions,p=>{n.currentSessionId&&!p.find(f=>f.id===n.currentSessionId)&&o("session-deleted",n.currentSessionId)}),(p,f)=>(u(),d("div",fe,[f[8]||(f[8]=e("h2",{class:"title"},"Unterhaltungen",-1)),e("button",{onClick:x,class:"new-session-btn"},f[1]||(f[1]=[e("i",{class:"fas fa-plus"},null,-1),M(" Neue Unterhaltung ")])),m.value?(u(),d("div",ve,f[2]||(f[2]=[e("div",{class:"loader"},null,-1),e("p",null,"Lade Unterhaltungen...",-1)]))):r.value.length===0?(u(),d("div",pe,f[3]||(f[3]=[e("p",null,"Keine Unterhaltungen vorhanden",-1),e("p",{class:"empty-note"},"Starten Sie eine neue Unterhaltung mit dem Assistenten",-1)]))):(u(),d("ul",Se,[(u(!0),d(H,null,O(t.value,w=>(u(),d("li",{key:w.id,onClick:F=>g(w.id),class:D(["session-item",{active:s.currentSessionId===w.id}])},[e("div",ye,[f[4]||(f[4]=e("i",{class:"fas fa-comment session-icon"},null,-1)),e("span",ke,C(w.title),1)]),e("button",{onClick:P(F=>_(w.id),["stop"]),class:"delete-button",title:"Unterhaltung löschen"},f[5]||(f[5]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,_e)],10,be))),128))])),l.value?(u(),d("div",we,[e("div",Ce,[f[6]||(f[6]=e("h3",null,"Unterhaltung löschen?",-1)),f[7]||(f[7]=e("p",null,"Möchten Sie diese Unterhaltung wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.",-1)),e("div",$e,[e("button",{onClick:b,class:"delete-confirm-btn"}," Löschen "),e("button",{onClick:f[0]||(f[0]=w=>l.value=!1),class:"cancel-btn"}," Abbrechen ")])])])):y("",!0)]))}},Ie=T(xe,[["__scopeId","data-v-99144df1"]]);const Fe={class:"message-actions"},Le={class:"feedback-buttons"},Me={key:0,class:"feedback-comment"},De={key:0,class:"source-buttons mt-2"},Ae={__name:"MessageActions",props:{message:{type:Object,required:!0},sessionId:{type:Number,required:!0}},emits:["show-sources","show-explanation"],setup(s,{emit:i}){const n=s,o=q(),a=async r=>{n.message.id&&await o.sendFeedback(n.message.id,n.sessionId,r)},l=()=>{o.prepareFeedback(n.message.id,n.sessionId),o.showFeedbackDialog=!0},c=r=>r?/\[\d+\]/.test(r):!1;return(r,t)=>(u(),d("div",Fe,[e("div",Le,[s.message.feedback_comment?(u(),d("span",Me,C(s.message.feedback_comment),1)):y("",!0),e("button",{onClick:t[0]||(t[0]=m=>a(!0)),class:D(["feedback-button",{selected:s.message.feedback_positive===!0}]),title:"Hilfreich"},t[4]||(t[4]=[e("i",{class:"fas fa-thumbs-up"},null,-1)]),2),e("button",{onClick:t[1]||(t[1]=m=>a(!1)),class:D(["feedback-button",{"selected negative":s.message.feedback_positive===!1}]),title:"Nicht hilfreich"},t[5]||(t[5]=[e("i",{class:"fas fa-thumbs-down"},null,-1)]),2),s.message.feedback_positive===!1?(u(),d("button",{key:1,onClick:l,class:"feedback-button",title:"Kommentar hinzufügen"},t[6]||(t[6]=[e("i",{class:"fas fa-comment"},null,-1)]))):y("",!0)]),c(s.message.message)?(u(),d("div",De,[e("button",{class:"source-btn",onClick:t[2]||(t[2]=m=>r.$emit("show-explanation",s.message))},t[7]||(t[7]=[e("i",{class:"fas fa-info-circle"},null,-1),M(" Antwort erklären ")])),e("button",{class:"source-btn",onClick:t[3]||(t[3]=m=>r.$emit("show-sources",s.message))},t[8]||(t[8]=[e("i",{class:"fas fa-bookmark"},null,-1),M(" Quellen anzeigen ")]))])):y("",!0)]))}},Ee=T(Ae,[["__scopeId","data-v-f6c60123"]]);const Te={class:"message-list"},Qe={key:0,class:"flex justify-center p-4"},Ue={key:1,class:"empty-state"},He={key:2,class:"messages-container"},Ne={key:0,class:"system-message"},Be=["innerHTML"],Ve=["innerHTML"],ze=["innerHTML"],Oe={__name:"MessageList",props:{messages:{type:Array,default:()=>[]},sessionId:{type:Number,default:null},loading:{type:Boolean,default:!1},isStreaming:{type:Boolean,default:!1}},emits:["show-sources","show-explanation"],setup(s,{emit:i}){q();const n=a=>a?K.parse(a,{gfm:!0,breaks:!0,sanitize:!0,smartypants:!0,highlight:function(l,c){return l}}):"",o=a=>{if(!a)return"";let l=n(a);return l=l.replace(/\[(\d+)\]/g,'<span class="source-reference" data-source-id="$1">[$1]</span>'),l};return(a,l)=>(u(),d("div",Te,[s.loading?(u(),d("div",Qe,l[0]||(l[0]=[e("div",{class:"loader"},null,-1)]))):s.messages.length===0?(u(),d("div",Ue,l[1]||(l[1]=[e("div",{class:"flex flex-col items-center justify-center text-gray-400 p-8"},[e("i",{class:"fas fa-comment-dots text-5xl text-gray-300 mb-4"}),e("h3",{class:"text-lg font-medium mb-2"},"Keine Nachrichten"),e("p",{class:"text-sm text-gray-500 mb-4"},"Stellen Sie eine Frage, um mit dem Assistenten zu beginnen.")],-1)]))):(u(),d("div",He,[(u(!0),d(H,null,O(s.messages,(c,r)=>(u(),d("div",{key:c.id||r,class:"mb-6"},[c.is_system?(u(),d("div",Ne,[e("div",{innerHTML:n(c.message),class:"prose"},null,8,Be)])):(u(),d("div",{key:1,class:D(["message-wrapper",c.is_user?"user-message":"assistant-message"])},[e("div",{class:D(c.is_user?"message-user":"message-assistant")},[c.is_user?(u(),d("div",{key:0,innerHTML:n(c.message),class:"prose"},null,8,Ve)):(u(),d("div",{key:1,innerHTML:o(c.message),class:"prose"},null,8,ze)),!c.is_user&&!s.isStreaming?(u(),me(Ee,{key:2,message:c,"session-id":s.sessionId,onShowSources:t=>a.$emit("show-sources",c),onShowExplanation:t=>a.$emit("show-explanation",c)},null,8,["message","session-id","onShowSources","onShowExplanation"])):y("",!0)],2)],2))]))),128))]))]))}},Pe=T(Oe,[["__scopeId","data-v-3aabde9e"]]);const qe={class:"chat-input"},Re=["disabled"],je=["disabled"],Ke={key:0},We={key:1},Ze={class:"settings-row"},Ge={class:"toggle-option"},Je={class:"toggle-option"},Xe={__name:"ChatInput",props:{disabled:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["question-sent"],setup(s,{emit:i}){const n=s,o=i,a=q(),l=k(""),c=k(null),r=k(a.useSimpleLanguage),t=k(a.useStreaming),m=async()=>{!l.value.trim()||n.disabled||n.isLoading||(a.setQuestion(l.value),await a.sendQuestion(),o("question-sent",l.value),l.value="",setTimeout(()=>{c.value&&c.value.focus()},100))},g=()=>{a.setSimpleLanguage(r.value)},x=()=>{a.setStreaming(t.value)};return j(()=>{a.loadSettings(),r.value=a.useSimpleLanguage,t.value=a.useStreaming}),N(()=>a.useSimpleLanguage,_=>{r.value=_}),N(()=>a.useStreaming,_=>{t.value=_}),(_,b)=>(u(),d("div",qe,[e("form",{onSubmit:P(m,["prevent"]),class:"chat-form"},[z(e("input",{"onUpdate:modelValue":b[0]||(b[0]=p=>l.value=p),class:"input-field",type:"text",placeholder:"Stellen Sie Ihre Frage zur nscale DMS-Software...",disabled:s.disabled||s.isLoading,ref_key:"inputRef",ref:c},null,8,Re),[[Y,l.value]]),e("button",{type:"submit",class:"send-button",disabled:s.disabled||s.isLoading||!l.value},[s.isLoading?(u(),d("span",Ke,b[3]||(b[3]=[e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),M(" Wird gesendet... ")]))):(u(),d("span",We,b[4]||(b[4]=[e("i",{class:"fas fa-paper-plane mr-2"},null,-1),M(" Senden ")])))],8,je)],32),e("div",Ze,[e("div",Ge,[z(e("input",{type:"checkbox",id:"simple-language","onUpdate:modelValue":b[1]||(b[1]=p=>r.value=p),onChange:g},null,544),[[J,r.value]]),b[5]||(b[5]=e("label",{for:"simple-language"},"Einfache Sprache verwenden",-1))]),e("div",Je,[z(e("input",{type:"checkbox",id:"streaming","onUpdate:modelValue":b[2]||(b[2]=p=>t.value=p),onChange:x},null,544),[[J,t.value]]),b[6]||(b[6]=e("label",{for:"streaming"},"Live-Streaming der Antwort",-1))])])]))}},Ye=T(Xe,[["__scopeId","data-v-57ffec58"]]);const es={class:"dialog-header"},ss={class:"dialog-content"},ts={key:0,class:"loading-state"},ns={key:0,class:"source-details"},is={class:"source-title"},as={class:"source-metadata"},os={class:"metadata-item"},ls={class:"metadata-value"},rs={class:"metadata-item"},us={class:"metadata-value"},ds={class:"metadata-item"},cs={class:"metadata-value"},ms={class:"source-content"},gs=["innerHTML"],hs={key:1,class:"sources-list"},fs=["onClick"],vs={class:"source-item-title"},ps={class:"source-number"},Ss={class:"source-name"},bs={class:"source-item-preview"},ys={class:"source-item-metadata"},ks={key:2,class:"explanation-content"},_s=["innerHTML"],ws={key:0,class:"explanation-sources"},Cs={class:"explanation-sources-list"},$s=["onClick"],xs={class:"source-number"},Is={class:"source-name"},Fs={key:3,class:"empty-state"},Ls={class:"dialog-footer"},Ms={__name:"SourceDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Quelleninformationen"},sources:{type:Array,default:()=>[]},source:{type:Object,default:null},explanation:{type:Object,default:null},loading:{type:Boolean,default:!1},closeOnBackdrop:{type:Boolean,default:!0}},emits:["close","back","select-source"],setup(s,{emit:i}){const n=r=>{if(r==null)return"Unbekannt";const t=Math.round(r*100);return t>=90?"Sehr hoch":t>=75?"Hoch":t>=60?"Mittel":t>=40?"Niedrig":"Sehr niedrig"},o=r=>{if(r==null)return{};const t=Math.round(r*100);return t>=90?{backgroundColor:"#dcfce7",color:"#166534"}:t>=75?{backgroundColor:"#d1fae5",color:"#065f46"}:t>=60?{backgroundColor:"#ecfdf5",color:"#047857"}:t>=40?{backgroundColor:"#f0fdfa",color:"#0f766e"}:{backgroundColor:"#eff6ff",color:"#1d4ed8"}},a=r=>{if(!r)return"Unbekannt";try{return new Date(r).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return r}},l=r=>r?K.parse(r,{gfm:!0,breaks:!0,sanitize:!0}):"",c=(r,t)=>r?r.length<=t?r:r.substring(0,t)+"...":"";return(r,t)=>s.show?(u(),d("div",{key:0,class:"source-dialog-overlay",onClick:t[4]||(t[4]=m=>s.closeOnBackdrop?r.$emit("close"):null)},[e("div",{class:"source-dialog",onClick:t[3]||(t[3]=P(()=>{},["stop"]))},[e("div",es,[e("h3",null,C(s.title),1),e("button",{class:"close-button",onClick:t[0]||(t[0]=m=>r.$emit("close"))},t[5]||(t[5]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",ss,[s.loading?(u(),d("div",ts,t[6]||(t[6]=[e("div",{class:"loader"},null,-1),e("p",null,"Lade Informationen...",-1)]))):(u(),d(H,{key:1},[s.source?(u(),d("div",ns,[e("h4",is,C(s.source.title),1),e("div",as,[e("div",os,[t[7]||(t[7]=e("span",{class:"metadata-label"},"Quelle:",-1)),e("span",ls,C(s.source.document),1)]),e("div",rs,[t[8]||(t[8]=e("span",{class:"metadata-label"},"Relevanz:",-1)),e("span",us,C(n(s.source.relevance)),1)]),e("div",ds,[t[9]||(t[9]=e("span",{class:"metadata-label"},"Zuletzt aktualisiert:",-1)),e("span",cs,C(a(s.source.updated)),1)])]),e("div",ms,[t[10]||(t[10]=e("div",{class:"content-label"},"Inhalt:",-1)),e("div",{class:"content-text",innerHTML:l(s.source.content)},null,8,gs)])])):s.sources&&s.sources.length>0?(u(),d("ul",hs,[(u(!0),d(H,null,O(s.sources,(m,g)=>(u(),d("li",{key:g,class:"source-item",onClick:x=>r.$emit("select-source",m)},[e("div",vs,[e("span",ps,"["+C(g+1)+"]",1),e("span",Ss,C(m.title||m.document),1)]),e("div",bs,C(c(m.content,120)),1),e("div",ys,[e("span",{class:"relevance-badge",style:U(o(m.relevance))},C(n(m.relevance)),5)])],8,fs))),128))])):s.explanation?(u(),d("div",ks,[t[12]||(t[12]=e("h4",{class:"explanation-title"},"Erklärung der Antwort",-1)),e("div",{class:"explanation-text",innerHTML:l(s.explanation.explanation)},null,8,_s),s.explanation.sources&&s.explanation.sources.length>0?(u(),d("div",ws,[t[11]||(t[11]=e("h4",{class:"explanation-subtitle"},"Verwendete Quellen",-1)),e("ul",Cs,[(u(!0),d(H,null,O(s.explanation.sources,(m,g)=>(u(),d("li",{key:g,class:"explanation-source-item",onClick:x=>r.$emit("select-source",m)},[e("span",xs,"["+C(g+1)+"]",1),e("span",Is,C(m.title||m.document),1)],8,$s))),128))])])):y("",!0)])):(u(),d("div",Fs,t[13]||(t[13]=[e("p",null,"Keine Informationen verfügbar",-1)])))],64))]),e("div",Ls,[s.source||s.explanation?(u(),d("button",{key:0,class:"back-button",onClick:t[1]||(t[1]=m=>r.$emit("back"))},t[14]||(t[14]=[e("i",{class:"fas fa-arrow-left"},null,-1),M(" Zurück zur Übersicht ")]))):y("",!0),e("button",{class:"close-button-text",onClick:t[2]||(t[2]=m=>r.$emit("close"))}," Schließen ")])])])):y("",!0)}},Ds=T(Ms,[["__scopeId","data-v-f7b5083b"]]);const As={class:"chat-view"},Es={class:"chat-container"},Ts={class:"sessions-sidebar"},Qs={class:"chat-main"},Us={key:0,class:"no-session"},Hs={class:"motd-inner"},Ns={key:0,class:"motd-icon"},Bs=["innerHTML"],Vs={key:1,class:"chat-content"},zs={class:"motd-inner"},Os={key:0,class:"motd-icon"},Ps=["innerHTML"],qs={class:"input-container"},Rs={class:"dialog-content"},js={class:"dialog-footer"},Ks=["disabled"],Ws={key:0},Zs={key:1},Gs={__name:"ChatView",setup(s){const i=q(),n=E(),o=ge(),a=k(null),l=k(""),c=$(()=>n.currentSessionId),r=$(()=>n.currentSession),t=$(()=>{var S;return((S=r.value)==null?void 0:S.messages)||[]}),m=$(()=>i.isProcessing),g=$(()=>i.streaming),x=$(()=>n.loading||i.loading),_=$(()=>i.showFeedbackDialog),b=$(()=>i.currentFeedback),p=k(!1),f=k("Quelleninformationen"),w=k([]),F=k(null),A=k(null),Q=k(!1),v=$(()=>o.motd),W=$(()=>o.dismissed),ee=S=>{L()},se=S=>{L()},te=S=>{S===c.value&&R(()=>{L()})},ne=async()=>{await n.createSession()&&L()},ie=S=>{R(()=>{L()})},L=()=>{R(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight)})},ae=S=>{Q.value=!0,f.value="Quellenreferenzen",p.value=!0,F.value=null,A.value=null,S.sources&&S.sources.length>0?w.value=S.sources:w.value=[],Q.value=!1},oe=async S=>{if(!(!S||!S.id)){Q.value=!0,f.value="Antwort-Erklärung",p.value=!0,F.value=null,w.value=[];try{await i.loadExplanation(S.id),A.value=i.currentExplanation}catch(h){console.error("Fehler beim Laden der Erklärung:",h),A.value=null}finally{Q.value=!1}}},le=S=>{F.value=S,w.value=[],f.value="Quellendetails"},re=()=>{F.value=null,A.value=null,f.value="Quellenreferenzen"},ue=()=>{p.value=!1,F.value=null,w.value=[],A.value=null},de=async()=>{!b.value.messageId||!l.value.trim()||(await i.sendFeedback(b.value.messageId,c.value,!1,l.value),l.value="",B())},B=()=>{i.showFeedbackDialog=!1,l.value=""},Z=()=>{o.setDismissed(!0)},G=S=>{if(!S)return"";try{const h=K.parse(S);return he.sanitize(h)}catch(h){return console.error("Fehler beim Rendern des Markdown-Inhalts:",h),"<p>Fehler beim Rendern des Inhalts</p>"}};return N(()=>i.currentAnswer,()=>{i.streaming&&L()}),N(()=>t.value.length,()=>{L()}),j(async()=>{i.loadSettings(),n.sessions.length===0&&await n.fetchSessions(),n.startSessionPolling(),await o.loadMotd(),L()}),(S,h)=>(u(),d("div",As,[e("div",Es,[e("aside",Ts,[V(Ie,{"current-session-id":c.value,onSessionSelected:ee,onSessionCreated:se,onSessionDeleted:te},null,8,["current-session-id"])]),e("main",Qs,[c.value?(u(),d("div",Vs,[v.value&&v.value.enabled&&v.value.display.showInChat&&!W.value?(u(),d("div",{key:0,class:"motd-banner",style:U({backgroundColor:v.value.style.backgroundColor,borderColor:v.value.style.borderColor,color:v.value.style.textColor,border:"1px solid "+v.value.style.borderColor})},[e("div",zs,[v.value.style.iconClass?(u(),d("div",Os,[e("i",{class:D(["fas",`fa-${v.value.style.iconClass}`])},null,2)])):y("",!0),e("div",{innerHTML:G(v.value.content),class:"motd-content"},null,8,Ps),v.value.display.dismissible?(u(),d("button",{key:1,onClick:Z,class:"dismiss-btn",style:U({color:v.value.style.textColor}),title:"Nachricht ausblenden"},h[7]||(h[7]=[e("i",{class:"fas fa-times"},null,-1)]),4)):y("",!0)])],4)):y("",!0),e("div",{class:"messages-container",ref_key:"messagesContainer",ref:a},[V(Pe,{messages:t.value,"session-id":c.value,loading:x.value,"is-streaming":g.value,onShowSources:ae,onShowExplanation:oe},null,8,["messages","session-id","loading","is-streaming"])],512),e("div",qs,[V(Ye,{disabled:!c.value||m.value,"is-loading":m.value,onQuestionSent:ie},null,8,["disabled","is-loading"])])])):(u(),d("div",Us,[v.value&&v.value.enabled&&v.value.display.showOnStartup&&!W.value?(u(),d("div",{key:0,class:"motd-banner motd-banner-startup",style:U({backgroundColor:v.value.style.backgroundColor,borderColor:v.value.style.borderColor,color:v.value.style.textColor,border:"1px solid "+v.value.style.borderColor})},[e("div",Hs,[v.value.style.iconClass?(u(),d("div",Ns,[e("i",{class:D(["fas",`fa-${v.value.style.iconClass}`])},null,2)])):y("",!0),e("div",{innerHTML:G(v.value.content),class:"motd-content"},null,8,Bs),v.value.display.dismissible?(u(),d("button",{key:1,onClick:Z,class:"dismiss-btn",style:U({color:v.value.style.textColor}),title:"Nachricht ausblenden"},h[2]||(h[2]=[e("i",{class:"fas fa-times"},null,-1)]),4)):y("",!0)])],4)):y("",!0),e("div",{class:"empty-state"},[h[4]||(h[4]=e("i",{class:"fas fa-comment-dots text-5xl text-gray-300 mb-4"},null,-1)),h[5]||(h[5]=e("h3",{class:"text-lg font-medium mb-2"},"Keine Unterhaltung ausgewählt",-1)),h[6]||(h[6]=e("p",{class:"text-sm text-gray-500 mb-4"},"Wählen Sie eine Unterhaltung aus der Seitenleiste oder starten Sie eine neue.",-1)),e("button",{onClick:ne,class:"new-session-btn"},h[3]||(h[3]=[e("i",{class:"fas fa-plus mr-2"},null,-1),M(" Neue Unterhaltung starten ")]))])]))])]),V(Ds,{show:p.value,title:f.value,sources:w.value,source:F.value,explanation:A.value,loading:Q.value,onClose:ue,onBack:re,onSelectSource:le},null,8,["show","title","sources","source","explanation","loading"]),_.value?(u(),d("div",{key:0,class:"feedback-dialog-overlay",onClick:B},[e("div",{class:"feedback-dialog",onClick:h[1]||(h[1]=P(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[h[8]||(h[8]=e("h3",null,"Feedback geben",-1)),e("button",{class:"close-button",onClick:B},"×")]),e("div",Rs,[h[9]||(h[9]=e("p",{class:"feedback-prompt"},"Bitte teilen Sie uns mit, warum diese Antwort nicht hilfreich war:",-1)),z(e("textarea",{"onUpdate:modelValue":h[0]||(h[0]=ce=>l.value=ce),class:"feedback-textarea",placeholder:"Ihr Feedback zur Antwort...",rows:"4"},null,512),[[Y,l.value]])]),e("div",js,[e("button",{onClick:de,class:"submit-button",disabled:m.value},[m.value?(u(),d("span",Ws,h[10]||(h[10]=[e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),M(" Wird gesendet... ")]))):(u(),d("span",Zs,"Feedback senden"))],8,Ks),e("button",{onClick:B,class:"cancel-button"},"Abbrechen")])])])):y("",!0)]))}},st=T(Gs,[["__scopeId","data-v-61315001"]]);export{st as C};
//# sourceMappingURL=ChatView.bffd6098.js.map
