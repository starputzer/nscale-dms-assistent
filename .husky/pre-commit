#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run linting
echo "ğŸ“ Checking code style..."
npm run lint:fix

# Run type checking
echo "ğŸ”§ Checking TypeScript types..."
npm run typecheck || {
  echo "âŒ TypeScript errors found. Please fix them before committing."
  exit 1
}

# Check for console.log statements
echo "ğŸš« Checking for console.log statements..."
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|js|vue)$' || true)
if [ -n "$FILES" ]; then
  for file in $FILES; do
    if grep -q "console\.log" "$file"; then
      echo "âš ï¸  Warning: console.log found in $file"
      echo "   Consider using a proper logging service instead."
    fi
  done
fi

# Format staged files
echo "ğŸ’… Formatting code..."
npx lint-staged

echo "âœ… Pre-commit checks passed!"