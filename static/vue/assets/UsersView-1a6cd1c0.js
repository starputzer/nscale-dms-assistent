import{d as V,u as E,a as z,_ as A,r as U,c as $,o as i,b as c,e,t as g,w as S,v as F,f as R,g as k,h as w,n as y,F as I,i as L,j as B,k as N,l as x,m as T,p,q as P,s as M,x as Z}from"./js/main.c1fc62cb.js";const q=V("user",{state:()=>({users:[],selectedUser:null,filter:{role:"all",search:""},sort:{field:"created_at",direction:"desc"},loading:!1,error:null,showUserModal:!1,modalMode:"create",confirmDialog:{show:!1,type:null,userId:null,newRole:null,message:""}}),getters:{filteredUsers:l=>{let n=[...l.users];if(l.filter.role!=="all"&&(n=n.filter(t=>t.role===l.filter.role)),l.filter.search.trim()){const t=l.filter.search.toLowerCase();n=n.filter(o=>o.email.toLowerCase().includes(t))}return n.sort((t,o)=>{let u=t[l.sort.field],r=o[l.sort.field];return(l.sort.field==="created_at"||l.sort.field==="last_login")&&(u=u||0,r=r||0),l.sort.direction==="asc"?u>r?1:-1:u<r?1:-1}),n},hasAdminAccess:()=>E().isAdmin,userStats:l=>({total:l.users.length,admins:l.users.filter(n=>n.role==="admin").length,standardUsers:l.users.filter(n=>n.role==="user").length})},actions:{async loadUsers(){var l,n;if(this.hasAdminAccess){this.loading=!0,this.error=null;try{const t=await z.get("/api/admin/users");this.users=t.data.users||[]}catch(t){console.error("Fehler beim Laden der Benutzer:",t),this.error=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.detail)||"Fehler beim Laden der Benutzer"}finally{this.loading=!1}}},async createUser(l){var n,t;if(this.hasAdminAccess){this.loading=!0,this.error=null;try{const o=await z.post("/api/admin/users",l);return await this.loadUsers(),!0}catch(o){throw console.error("Fehler beim Erstellen des Benutzers:",o),this.error=((t=(n=o.response)==null?void 0:n.data)==null?void 0:t.detail)||"Fehler beim Erstellen des Benutzers",new Error(this.error)}finally{this.loading=!1}}},async updateUserRole(l,n){var t,o;if(this.hasAdminAccess){this.loading=!0,this.error=null;try{const u=await z.put(`/api/admin/users/${l}/role`,{role:n});return await this.loadUsers(),!0}catch(u){throw console.error(`Fehler beim Aktualisieren der Rolle für Benutzer ${l}:`,u),this.error=((o=(t=u.response)==null?void 0:t.data)==null?void 0:o.detail)||"Fehler beim Aktualisieren der Benutzerrolle",new Error(this.error)}finally{this.loading=!1}}},async deleteUser(l){var n,t;if(this.hasAdminAccess){this.loading=!0,this.error=null;try{const o=await z.delete(`/api/admin/users/${l}`);return await this.loadUsers(),!0}catch(o){throw console.error(`Fehler beim Löschen des Benutzers ${l}:`,o),this.error=((t=(n=o.response)==null?void 0:n.data)==null?void 0:t.detail)||"Fehler beim Löschen des Benutzers",new Error(this.error)}finally{this.loading=!1}}},selectUser(l){this.selectedUser=l},setFilter(l){this.filter={...this.filter,...l}},toggleSort(l){this.sort.field===l?this.sort.direction=this.sort.direction==="asc"?"desc":"asc":(this.sort.field=l,this.sort.direction="desc")},openUserModal(l,n=null){this.modalMode=l,this.selectedUser=n,this.showUserModal=!0},closeUserModal(){this.showUserModal=!1,this.selectedUser=null},openConfirmDialog(l,n){let t="";if(l==="delete"){const o=this.users.find(u=>u.id===n.userId);t=`Möchten Sie den Benutzer "${(o==null?void 0:o.email)||"Unbekannt"}" wirklich löschen?`}else if(l==="role"){const o=this.users.find(r=>r.id===n.userId),u=n.newRole==="admin"?"Administrator":"Standardbenutzer";t=`Möchten Sie die Rolle von "${(o==null?void 0:o.email)||"Unbekannt"}" zu "${u}" ändern?`}this.confirmDialog={show:!0,type:l,userId:n.userId,newRole:n.newRole,message:t}},closeConfirmDialog(){this.confirmDialog={show:!1,type:null,userId:null,newRole:null,message:""}},async confirmAction(){try{this.confirmDialog.type==="delete"?await this.deleteUser(this.confirmDialog.userId):this.confirmDialog.type==="role"&&await this.updateUserRole(this.confirmDialog.userId,this.confirmDialog.newRole)}catch{}finally{this.closeConfirmDialog()}}}});const j={class:"user-list"},K={class:"list-header"},G={class:"list-title"},O={class:"filter-controls"},Q={class:"filter-select"},H={class:"search-box"},J={key:0,class:"loading-container"},W={key:1,class:"empty-state"},X={key:2,class:"users-table-container"},Y={class:"users-table"},ee={key:1,class:"fas fa-sort"},se={key:1,class:"fas fa-sort"},te={key:1,class:"fas fa-sort"},le={key:1,class:"fas fa-sort"},re={key:1,class:"fas fa-sort"},ne={class:"email-cell"},oe={class:"actions-cell"},ae=["onClick"],ie=["onClick"],de=["onClick"],ue={__name:"UserList",props:{users:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},title:{type:String,default:"Benutzerliste"}},emits:["filter-change","sort-change","add-user","change-role","delete-user"],setup(l,{emit:n}){const t=n,o=U("all"),u=U(""),r=U("created_at"),f=U("desc"),m=$(()=>o.value!=="all"||u.value.trim()!==""),b=$(()=>m.value?"Keine passenden Benutzer gefunden.":"Noch keine Benutzer vorhanden."),C=()=>{t("filter-change",{role:o.value,search:u.value})},h=()=>{o.value="all",u.value="",C()},d=v=>{r.value===v?f.value=f.value==="asc"?"desc":"asc":(r.value=v,f.value="desc"),t("sort-change",{field:r.value,direction:f.value})},_=v=>v?new Date(v*1e3).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):null;return(v,s)=>(i(),c("div",j,[e("div",K,[e("h2",G,g(l.title),1),e("div",O,[e("div",Q,[S(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>o.value=a),onChange:C},s[8]||(s[8]=[e("option",{value:"all"},"Alle Rollen",-1),e("option",{value:"admin"},"Administratoren",-1),e("option",{value:"user"},"Standardbenutzer",-1)]),544),[[F,o.value]])]),e("div",H,[S(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=a=>u.value=a),placeholder:"Suche nach E-Mail...",onInput:C},null,544),[[R,u.value]]),s[9]||(s[9]=e("i",{class:"fas fa-search"},null,-1))]),e("button",{onClick:s[2]||(s[2]=a=>v.$emit("add-user")),class:"add-btn"},s[10]||(s[10]=[e("i",{class:"fas fa-user-plus"},null,-1),k(" Benutzer hinzufügen ")]))])]),l.loading?(i(),c("div",J,s[11]||(s[11]=[e("div",{class:"loader"},null,-1),e("span",null,"Benutzer werden geladen...",-1)]))):l.users.length===0?(i(),c("div",W,[s[12]||(s[12]=e("i",{class:"fas fa-users-slash"},null,-1)),e("p",null,g(b.value),1),m.value?(i(),c("button",{key:0,class:"reset-filters-btn",onClick:h}," Filter zurücksetzen ")):w("",!0)])):(i(),c("div",X,[e("table",Y,[e("thead",null,[e("tr",null,[e("th",{onClick:s[3]||(s[3]=a=>d("id")),class:"sortable-header"},[s[13]||(s[13]=k(" ID ")),r.value==="id"?(i(),c("i",{key:0,class:y(["fas",f.value==="asc"?"fa-sort-up":"fa-sort-down"])},null,2)):(i(),c("i",ee))]),e("th",{onClick:s[4]||(s[4]=a=>d("email")),class:"sortable-header"},[s[14]||(s[14]=k(" E-Mail ")),r.value==="email"?(i(),c("i",{key:0,class:y(["fas",f.value==="asc"?"fa-sort-up":"fa-sort-down"])},null,2)):(i(),c("i",se))]),e("th",{onClick:s[5]||(s[5]=a=>d("role")),class:"sortable-header"},[s[15]||(s[15]=k(" Rolle ")),r.value==="role"?(i(),c("i",{key:0,class:y(["fas",f.value==="asc"?"fa-sort-up":"fa-sort-down"])},null,2)):(i(),c("i",te))]),e("th",{onClick:s[6]||(s[6]=a=>d("created_at")),class:"sortable-header"},[s[16]||(s[16]=k(" Erstellt am ")),r.value==="created_at"?(i(),c("i",{key:0,class:y(["fas",f.value==="asc"?"fa-sort-up":"fa-sort-down"])},null,2)):(i(),c("i",le))]),e("th",{onClick:s[7]||(s[7]=a=>d("last_login")),class:"sortable-header"},[s[17]||(s[17]=k(" Letzter Login ")),r.value==="last_login"?(i(),c("i",{key:0,class:y(["fas",f.value==="asc"?"fa-sort-up":"fa-sort-down"])},null,2)):(i(),c("i",re))]),s[18]||(s[18]=e("th",null,"Aktionen",-1))])]),e("tbody",null,[(i(!0),c(I,null,L(l.users,a=>(i(),c("tr",{key:a.id,class:y({"admin-row":a.role==="admin"})},[e("td",null,g(a.id),1),e("td",ne,g(a.email),1),e("td",null,[e("span",{class:y(["role-badge",{"admin-badge":a.role==="admin","user-badge":a.role==="user"}])},g(a.role==="admin"?"Administrator":"Standardbenutzer"),3)]),e("td",null,g(_(a.created_at)),1),e("td",null,g(_(a.last_login)||"Nie"),1),e("td",oe,[a.role==="user"?(i(),c("button",{key:0,onClick:D=>v.$emit("change-role",{userId:a.id,newRole:"admin"}),class:"action-btn promote-btn",title:"Zum Administrator hochstufen"},s[19]||(s[19]=[e("i",{class:"fas fa-user-shield"},null,-1)]),8,ae)):(i(),c("button",{key:1,onClick:D=>v.$emit("change-role",{userId:a.id,newRole:"user"}),class:"action-btn demote-btn",title:"Zu Standardbenutzer herabstufen"},s[20]||(s[20]=[e("i",{class:"fas fa-user"},null,-1)]),8,ie)),e("button",{onClick:D=>v.$emit("delete-user",a.id),class:"action-btn delete-btn",title:"Benutzer löschen"},s[21]||(s[21]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,de)])],2))),128))])])]))]))}},ce=A(ue,[["__scopeId","data-v-438cbf18"]]);const fe={class:"form-header"},me={key:0,class:"error-message"},ve={class:"form-body"},ge={class:"form-group"},pe=["disabled"],he={key:0,class:"validation-error"},ye={class:"form-group"},we={class:"password-field"},be=["type"],ke={key:0,class:"validation-error"},$e={class:"form-group"},Ce={key:0,class:"role-info"},Ue={class:"form-footer"},_e=["disabled"],Se={key:0,class:"fas fa-spinner fa-spin"},ze={__name:"UserForm",props:{mode:{type:String,default:"create",validator:l=>["create","edit"].includes(l)},user:{type:Object,default:null},loading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["save","close"],setup(l,{emit:n}){const t=l,o=n,u=U(!1),r=U({email:"",password:"",role:"user"}),f=U({email:"",password:""}),m=$(()=>t.mode==="create"),b=$(()=>!r.value.email||m.value&&!r.value.password?!1:!f.value.email&&!f.value.password),C=()=>{const v=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return r.value.email?v.test(r.value.email)?(f.value.email="",!0):(f.value.email="Ungültige E-Mail-Adresse",!1):(f.value.email="E-Mail-Adresse ist erforderlich",!1)},h=()=>m.value&&!r.value.password?(f.value.password="Passwort ist erforderlich",!1):r.value.password&&r.value.password.length<8?(f.value.password="Passwort muss mindestens 8 Zeichen lang sein",!1):(f.value.password="",!0),d=()=>{const v=C(),s=h();return v&&s},_=()=>{d()&&o("save",{email:r.value.email,password:r.value.password,role:r.value.role})};return B(()=>t.user,v=>{v?r.value={email:v.email||"",password:"",role:v.role||"user"}:r.value={email:"",password:"",role:"user"}},{immediate:!0}),B(()=>r.value.email,C),B(()=>r.value.password,h),(v,s)=>(i(),c("div",{class:"modal-overlay",onClick:s[7]||(s[7]=a=>v.$emit("close"))},[e("div",{class:"user-form",onClick:s[6]||(s[6]=x(()=>{},["stop"]))},[e("div",fe,[e("h3",null,g(m.value?"Neuen Benutzer erstellen":"Benutzer bearbeiten"),1),e("button",{class:"close-btn",onClick:s[0]||(s[0]=a=>v.$emit("close"))},s[8]||(s[8]=[e("i",{class:"fas fa-times"},null,-1)]))]),l.error?(i(),c("div",me,[s[9]||(s[9]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),k(" "+g(l.error),1)])):w("",!0),e("div",ve,[e("div",ge,[s[10]||(s[10]=e("label",{for:"email"},"E-Mail-Adresse",-1)),S(e("input",{type:"email",id:"email","onUpdate:modelValue":s[1]||(s[1]=a=>r.value.email=a),disabled:!m.value,class:y(["form-control",{"is-invalid":f.value.email}])},null,10,pe),[[R,r.value.email]]),f.value.email?(i(),c("div",he,g(f.value.email),1)):w("",!0)]),e("div",ye,[s[11]||(s[11]=e("label",{for:"password"},"Passwort",-1)),e("div",we,[S(e("input",{type:u.value?"text":"password",id:"password","onUpdate:modelValue":s[2]||(s[2]=a=>r.value.password=a),class:y(["form-control",{"is-invalid":f.value.password}])},null,10,be),[[N,r.value.password]]),e("button",{type:"button",class:"toggle-password",onClick:s[3]||(s[3]=a=>u.value=!u.value)},[e("i",{class:y(["fas",u.value?"fa-eye-slash":"fa-eye"])},null,2)])]),f.value.password?(i(),c("div",ke,g(f.value.password),1)):w("",!0)]),e("div",$e,[s[13]||(s[13]=e("label",{for:"role"},"Rolle",-1)),S(e("select",{id:"role","onUpdate:modelValue":s[4]||(s[4]=a=>r.value.role=a),class:"form-control"},s[12]||(s[12]=[e("option",{value:"user"},"Standardbenutzer",-1),e("option",{value:"admin"},"Administrator",-1)]),512),[[F,r.value.role]])]),r.value.role==="admin"?(i(),c("div",Ce,s[14]||(s[14]=[e("i",{class:"fas fa-info-circle"},null,-1),k(" Administratoren haben vollen Zugriff auf alle Systemfunktionen, einschließlich Benutzerverwaltung und Konfigurationseinstellungen. ")]))):w("",!0)]),e("div",Ue,[e("button",{type:"button",class:"cancel-btn",onClick:s[5]||(s[5]=a=>v.$emit("close"))}," Abbrechen "),e("button",{type:"button",class:"save-btn",disabled:l.loading||!b.value,onClick:_},[l.loading?(i(),c("i",Se)):w("",!0),k(" "+g(m.value?"Benutzer erstellen":"Benutzer speichern"),1)],8,_e)])])]))}},Ae=A(ze,[["__scopeId","data-v-01c5f82a"]]);const Be={class:"dialog-header"},De={class:"dialog-body"},Me={class:"dialog-icon"},Fe={class:"dialog-message"},Re={class:"dialog-footer"},xe={__name:"ConfirmDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Bestätigung"},message:{type:String,default:"Möchten Sie diese Aktion wirklich durchführen?"},type:{type:String,default:"primary",validator:l=>["primary","danger","warning","info"].includes(l)},confirmText:{type:String,default:"Bestätigen"},cancelText:{type:String,default:"Abbrechen"}},emits:["confirm","cancel"],setup(l,{emit:n}){const t=l,o=n,u=$(()=>{switch(t.type){case"danger":return"fa-exclamation-circle";case"warning":return"fa-exclamation-triangle";case"info":return"fa-info-circle";default:return"fa-question-circle"}}),r=$(()=>{switch(t.type){case"danger":return"confirm-btn-danger";case"warning":return"confirm-btn-warning";case"info":return"confirm-btn-info";default:return"confirm-btn-primary"}});return(f,m)=>l.show?(i(),c("div",{key:0,class:"confirm-dialog-overlay",onClick:m[4]||(m[4]=b=>o("cancel"))},[e("div",{class:"confirm-dialog",onClick:m[3]||(m[3]=x(()=>{},["stop"]))},[e("div",Be,[e("h3",null,g(l.title),1),e("button",{class:"close-btn",onClick:m[0]||(m[0]=b=>o("cancel"))},m[5]||(m[5]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",De,[e("div",Me,[e("i",{class:y(["fas",u.value])},null,2)]),e("p",Fe,g(l.message),1)]),e("div",Re,[e("button",{type:"button",class:"cancel-btn",onClick:m[1]||(m[1]=b=>o("cancel"))},g(l.cancelText),1),e("button",{type:"button",class:y(["confirm-btn",r.value]),onClick:m[2]||(m[2]=b=>o("confirm"))},g(l.confirmText),3)])])])):w("",!0)}},Ve=A(xe,[["__scopeId","data-v-8851b85b"]]);const Ee={class:"admin-sub-view users-view"},Ie={class:"user-stats"},Le={class:"stat-card"},Ne={class:"stat-info"},Te={class:"stat-card"},Pe={class:"stat-info"},Ze={class:"stat-card"},qe={class:"stat-info"},je={key:0,class:"error-notification"},Ke={__name:"UsersView",setup(l){const n=Z(),t=q(),o=$(()=>{switch(n.name||""){case"AdminUsers":return"Benutzerverwaltung";default:return"Administration"}}),u=$(()=>t.confirmDialog.type==="delete"?"Benutzer löschen":t.confirmDialog.type==="role"?"Benutzerrolle ändern":"Bestätigung"),r=$(()=>t.confirmDialog.type==="delete"?"danger":t.confirmDialog.type==="role"?"warning":"primary"),f=h=>{t.toggleSort(h.field)},m=async h=>{try{t.modalMode==="create"&&await t.createUser(h),t.closeUserModal()}catch{}},b=h=>{t.openConfirmDialog("delete",{userId:h})},C=h=>{t.openConfirmDialog("role",h)};return T(()=>{t.loadUsers()}),(h,d)=>(i(),c("div",Ee,[e("h1",null,g(o.value),1),e("div",Ie,[e("div",Le,[d[3]||(d[3]=e("div",{class:"stat-icon"},[e("i",{class:"fas fa-users"})],-1)),e("div",Ne,[e("h2",null,g(p(t).userStats.total),1),d[2]||(d[2]=e("p",null,"Gesamtbenutzer",-1))])]),e("div",Te,[d[5]||(d[5]=e("div",{class:"stat-icon admin-icon"},[e("i",{class:"fas fa-user-shield"})],-1)),e("div",Pe,[e("h2",null,g(p(t).userStats.admins),1),d[4]||(d[4]=e("p",null,"Administratoren",-1))])]),e("div",Ze,[d[7]||(d[7]=e("div",{class:"stat-icon user-icon"},[e("i",{class:"fas fa-user"})],-1)),e("div",qe,[e("h2",null,g(p(t).userStats.standardUsers),1),d[6]||(d[6]=e("p",null,"Standardbenutzer",-1))])])]),p(t).error?(i(),c("div",je,[d[9]||(d[9]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),e("p",null,g(p(t).error),1),e("button",{onClick:d[0]||(d[0]=_=>p(t).error=null),class:"dismiss-btn"},d[8]||(d[8]=[e("i",{class:"fas fa-times"},null,-1)]))])):w("",!0),P(ce,{users:p(t).filteredUsers,loading:p(t).loading,title:"Registrierte Benutzer",onFilterChange:p(t).setFilter,onSortChange:f,onAddUser:d[1]||(d[1]=_=>p(t).openUserModal("create")),onChangeRole:C,onDeleteUser:b},null,8,["users","loading","onFilterChange"]),p(t).showUserModal?(i(),M(Ae,{key:1,mode:p(t).modalMode,user:p(t).selectedUser,loading:p(t).loading,error:p(t).error,onSave:m,onClose:p(t).closeUserModal},null,8,["mode","user","loading","error","onClose"])):w("",!0),p(t).confirmDialog.show?(i(),M(Ve,{key:2,title:u.value,message:p(t).confirmDialog.message,type:r.value,onConfirm:p(t).confirmAction,onCancel:p(t).closeConfirmDialog},null,8,["title","message","type","onConfirm","onCancel"])):w("",!0)]))}},Oe=A(Ke,[["__scopeId","data-v-8438f0ea"]]);export{Oe as default};
//# sourceMappingURL=UsersView-1a6cd1c0.js.map
