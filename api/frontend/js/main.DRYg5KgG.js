const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/docConverter.B4GgtZ8D.js","js/chunks/vendor-vue-D3L_ePxu.js","js/chunks/vendor-BRQMajHQ.js","js/chunks/vendor-pinia-DzTZc5iZ.js","js/chunks/components-LKWq85iN.js","css/docConverter.BtdKbvBy.css"])))=>i.map(i=>d[i]);
import{l as e}from"./chunks/vendor-vue-D3L_ePxu.js";import{c as t}from"./chunks/vendor-pinia-DzTZc5iZ.js";import{v as n,s as a}from"./chunks/uuid-util-C8eait6C.js";import{s}from"./admin.OxJHaFPS.js";import"./chunks/vendor-BRQMajHQ.js";const o={},i=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e})),(e=>({status:"rejected",reason:e}))))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),s=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));a=e(t.map((e=>{if((e=function(e){return"/"+e}(e))in o)return;o[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise(((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then((t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)}))};var r,l;r="ab-testing",l="initialize",void 0!==window.telemetry&&window.telemetry.trackEvent("legacy_code_usage",{component:r,action:l,timestamp:(new Date).toISOString()});const u={"chat-interface-v2":{id:"chat-interface-v2",description:"Verbesserte Chat-Oberfläche mit optimierter Nachrichtenanzeige",variants:["control","variant"],featureFlags:{control:{useSfcChat:!1,useEnhancedChat:!1},variant:{useSfcChat:!0,useEnhancedChat:!0}},eligibilityCheck:()=>!0,metrics:["messageResponseTime","userSatisfaction","sessionDuration"]},"doc-converter-batch-v2":{id:"doc-converter-batch-v2",description:"Optimierter Dokumentenkonverter mit Batch-Verarbeitung",variants:["control","variant"],featureFlags:{control:{useSfcDocConverter:!1,useVueDocConverter:!1},variant:{useSfcDocConverter:!0,useVueDocConverter:!0}},eligibilityCheck:()=>!0,metrics:["conversionSpeed","conversionSuccess","userSatisfaction"]},"admin-panel-v2":{id:"admin-panel-v2",description:"Neu gestalteter Admin-Bereich mit verbesserten Analysen",variants:["control","variant"],featureFlags:{control:{useSfcAdmin:!1},variant:{useSfcAdmin:!0}},eligibilityCheck:()=>{const e=JSON.parse(localStorage.getItem("user")||"{}");return"admin"===e.role||"super_admin"===e.role},metrics:["taskCompletionTime","navigationEfficiency","userSatisfaction"]}};let c=localStorage.getItem("abTestSessionId");function d(e){const t=localStorage.getItem("userId")||c,n=u[e];if(!n)return null;if(!n.eligibilityCheck())return null;const s=JSON.parse(localStorage.getItem("abTestAssignments")||"{}");if(s[e])return s[e];const o=n.variants,i=o[Math.floor(Math.random()*o.length)];s[e]=i,localStorage.setItem("abTestAssignments",JSON.stringify(s));const r=n.featureFlags[i];return r&&Object.entries(r).forEach((([e,t])=>{a(e,t)})),g("ab_test_assignment",{testId:e,variant:i,userId:t,timestamp:(new Date).toISOString()}),i}function v(e){return JSON.parse(localStorage.getItem("abTestAssignments")||"{}")[e]||null}function m(e,t,n,a={}){const s=v(e);if(!s)return;const o=u[e];o&&o.metrics.includes(t)&&g("ab_test_metric",{testId:e,variant:s,metricName:t,value:n,userId:localStorage.getItem("userId")||c,timestamp:(new Date).toISOString(),...a})}function g(e,t){if(window.telemetry&&"function"==typeof window.telemetry.trackEvent)return void window.telemetry.trackEvent(e,t);const n={...t,eventType:e,appVersion:window.appVersion||"unknown",userAgent:navigator.userAgent,platform:navigator.platform};"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&fetch("/api/telemetry",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),keepalive:!0}).catch((e=>{})),localStorage.getItem("enableTelemetryDebug")}function p(){Object.keys(u).forEach((e=>{const t=v(e);if(t){const n=u[e].featureFlags[t];n&&Object.entries(n).forEach((([e,t])=>{a(e,t)}))}else d(e)})),g("ab_tests_initialized",{userId:localStorage.getItem("userId")||c,assignments:JSON.parse(localStorage.getItem("abTestAssignments")||"{}"),timestamp:(new Date).toISOString()})}c||(c=n(),localStorage.setItem("abTestSessionId",c)),"undefined"!=typeof window&&(window.abTesting={assignUserToTest:d,getUserTestVariant:v,trackTestMetric:m,listAvailableTests:function(){return Object.values(u).map((e=>({id:e.id,description:e.description,variants:e.variants,metrics:e.metrics})))},exitTest:function(e){const t=JSON.parse(localStorage.getItem("abTestAssignments")||"{}");if(!t[e])return!1;const n=t[e];return delete t[e],localStorage.setItem("abTestAssignments",JSON.stringify(t)),g("ab_test_exit",{testId:e,variant:n,userId:localStorage.getItem("userId")||c,timestamp:(new Date).toISOString()}),!0},initializeABTests:p}),function(e,t){void 0!==window.telemetry&&window.telemetry.trackEvent("legacy_code_usage",{component:e,action:t,timestamp:(new Date).toISOString()})}("chat","initialize"),function(e,t){void 0!==window.telemetry&&window.telemetry.trackEvent("legacy_code_usage",{component:e,action:t,timestamp:(new Date).toISOString()})}("feedback","initialize"),function(e,t){void 0!==window.telemetry&&window.telemetry.trackEvent("legacy_code_usage",{component:e,action:t,timestamp:(new Date).toISOString()})}("settings","initialize"),function(e,t){void 0!==window.telemetry&&window.telemetry.trackEvent("legacy_code_usage",{component:e,action:t,timestamp:(new Date).toISOString()})}("source-references","initialize"),function(e,t){void 0!==window.telemetry&&window.telemetry.trackEvent("legacy_code_usage",{component:e,action:t,timestamp:(new Date).toISOString()})}("app","initialize");const f=window.Vue,{createApp:h,ref:b,onMounted:w,watch:y,nextTick:S}=f;function k(){if("true"===localStorage.getItem("useVueComponents"))try{i((async()=>{const{default:e}=await import("./chunks/app-DLW8Fqow.js");return{default:e}}),[]).then((({default:n})=>{const a=e(n),s=t();a.use(s),a.config.errorHandler=(e,t,n)=>{};document.getElementById("vue-app")&&a.mount("#vue-app")})).catch((e=>{}))}catch(n){}x()}function x(){var n;const a="true"===localStorage.getItem("useVueDocConverter"),s=document.getElementById("doc-converter-mount");if(a&&s)try{i((async()=>{const{default:e}=await import("./docConverter.B4GgtZ8D.js");return{default:e}}),__vite__mapDeps([0,1,2,3,4,5])).then((({default:n})=>{const a=e(n),s=t();a.use(s),a.mount("#doc-converter-mount")})).catch((e=>{var t;null==(t=document.getElementById("legacy-doc-converter"))||t.classList.remove("hidden")}))}catch(o){null==(n=document.getElementById("legacy-doc-converter"))||n.classList.remove("hidden")}}h({setup(){const e=b(localStorage.getItem("token")||""),t=b(""),n=b(""),a=b("login"),o=b(!1),i=b(""),r=b(""),l=b([]),u=b(null),c=b([]),d=b(""),g=b(!1),f=b(null),h=b(!1),k=b(null),x=b("chat"),_=b("user"),I=b(!1),E=b(""),T=b(null),D=b(null),C=b("true"===localStorage.getItem("motdDismissed")||!1),L={warning:{backgroundColor:"#fff3cd",borderColor:"#ffeeba",textColor:"#856404"},info:{backgroundColor:"#e1ecf8",borderColor:"#bee5eb",textColor:"#0c5460"},success:{backgroundColor:"#e0f5ea",borderColor:"#c3e6cb",textColor:"#155724"},danger:{backgroundColor:"#f8d7da",borderColor:"#f5c6cb",textColor:"#721c24"},neutral:{backgroundColor:"#f8f9fa",borderColor:"#dee2e6",textColor:"#495057"}},$=b("warning"),A=e=>{e&&localStorage.setItem("lastActiveSession",e)},M=async()=>{try{const e=localStorage.getItem("lastActiveSession");if(e&&l.value.length>0){if(l.value.some((t=>t.id===parseInt(e))))return await F(parseInt(e)),!0;localStorage.removeItem("lastActiveSession")}}catch(e){}return!1},O=()=>{axios.defaults.headers.common.Authorization=e.value?`Bearer ${e.value}`:""},V=e=>{var t,n;try{if(!(null==(t=window.abTesting)?void 0:t.getUserTestVariant("chat-interface-v2")))return;const a=localStorage.getItem(`session_${e}_start_time`);if(a){const t=parseInt(a,10),s=Date.now()-t,o=Math.floor(s/1e3);null==(n=window.abTesting)||n.trackTestMetric("chat-interface-v2","sessionDuration",o,{sessionId:e,messagesCount:c.value.length}),localStorage.removeItem(`session_${e}_start_time`)}}catch(a){}},F=async e=>{var t;try{u.value&&u.value!==e&&V(u.value),g.value=!0;const n=null==(t=window.abTesting)?void 0:t.getUserTestVariant("chat-interface-v2"),a=Date.now();n&&localStorage.setItem(`session_${e}_start_time`,a.toString());const s=await axios.get(`/api/session/${e}`);u.value=e,A(e),c.value=s.data.messages,c.value&&c.value.length>0?(C.value=!0,localStorage.setItem("motdDismissed","true")):(C.value=!1,localStorage.removeItem("motdDismissed"));for(const e of c.value)!e.is_user&&e.id&&await U.loadMessageFeedback(e.id);x.value="chat",await S(),B()}catch(n){}finally{g.value=!1}},N=async()=>{try{const e=await axios.get("/api/sessions"),t=JSON.parse(JSON.stringify(e.data.sessions));let n=!1;if(l.value.length>0&&t.length===l.value.length){for(let a=0;a<l.value.length;a++)if(l.value[a].title!==t[a].title){n=!0;break}}else n=!0;(n||l.value.length!==t.length)&&(l.value=t)}catch(e){}},R=e=>marked.parse(e),B=()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)},P=async e=>{if(!e)return!1;try{const t=await axios.post(`/api/session/${e}/update-title`);return!(!t.data||!t.data.new_title)&&(await N(),!0)}catch(t){return!1}},z=async()=>{if(l.value&&0!==l.value.length)try{await N(),u.value&&await P(u.value)}catch(e){}},Q=async()=>{if(u.value)try{return await F(u.value),!0}catch(e){return!1}return!1},j=function(e){const{token:t,messages:n,question:a,currentSessionId:s,isLoading:o,isStreaming:i,eventSource:r,scrollToBottom:l,nextTick:u,loadSessions:c,motdDismissed:d}=e;let g,p=0,f=0,h="",b=null;const w=()=>{if(g&&(clearTimeout(g),g=null),p=0,f=0,r.value)try{r.value.onmessage=null,r.value.onerror=null,r.value.removeEventListener("done",S),r.value.close(),r.value=null}catch(e){}o.value=!1,i.value=!1},y=()=>{g&&clearTimeout(g),g=setTimeout((()=>{i.value&&w()}),3e4)},S=async e=>{const t=n.value.length-1;t>=0&&!n.value[t].message.trim()&&(n.value[t].message="Es wurden keine Daten empfangen. Bitte versuchen Sie es später erneut."),null!==b&&t>=0&&(n.value[t].id=b,n.value[t].session_id=s.value);try{c&&"function"==typeof c&&await c()}catch(a){}w()};return{sendQuestionStream:async()=>{if(!a.value.trim()||!s.value)return;const e=v("chat-interface-v2"),g=Date.now();d&&(d.value=!0);try{o.value=!0,i.value=!0,b=null,n.value.push({is_user:!0,message:a.value,timestamp:Date.now()/1e3});const d=n.value.length;n.value.push({is_user:!1,message:"",timestamp:Date.now()/1e3,session_id:s.value}),await u(),l();const v=new URL("/api/question/stream",window.location.origin);v.searchParams.append("question",a.value),v.searchParams.append("session_id",s.value),!0===window.useSimpleLanguage&&v.searchParams.append("simple_language","true");const S=t.value.replace(/^Bearer\\s+/i,"");v.searchParams.append("auth_token",S),r.value&&(r.value.close(),r.value=null),r.value=new EventSource(v.toString()),p=0,f=0,h="",r.value.onmessage=e=>{try{if(y(),!e.data||""===e.data.trim())return;if(e.data.includes("event: done"))return void k(e);if("[STREAM_RETRY]"===e.data)return f++,n.value[d].message+=`\n[Verbindung wird wiederhergestellt... Versuch ${f}]\n`,void l();if("[TIMEOUT]"===e.data)return;if(e.data.startsWith("[FINAL_TIMEOUT]")||e.data.startsWith("[CONN_ERROR]")||e.data.startsWith("[ERROR]")||e.data.startsWith("[UNEXPECTED_ERROR]")||e.data.startsWith("[NO_TOKENS]"))return n.value[d].message.trim()?n.value[d].message+="\n\n[Hinweis: Die Antwort wurde möglicherweise abgeschnitten.]":n.value[d].message="Es ist ein Fehler aufgetreten. Bitte versuchen Sie es später erneut.",l(),void w();try{let t=e.data;t.startsWith("data: ")&&(t=t.substring(6));const a=JSON.parse(t);if("message_id"in a)return b=a.message_id,n.value[d].id=b,void(n.value[d].session_id=s.value);if("response"in a){const e=a.response;p++,h+=e,n.value[d].message=h,l()}else a.error&&(n.value[d].message=`Fehler: ${a.error}`,w())}catch(t){}}catch(a){}};const k=async t=>{e&&m("chat-interface-v2","messageResponseTime",Date.now()-g,{messageLength:h.length,tokensReceived:p,streamRetries:f});const a=n.value.length-1;if(a>=0&&!n.value[a].message.trim()&&(n.value[a].message="Es wurden keine Daten empfangen. Bitte versuchen Sie es später erneut."),null!==b&&a>=0)n.value[a].id=b,n.value[a].session_id=s.value;else if(a>=0){const e=Date.now();n.value[a].id=e,n.value[a].session_id=s.value}try{c&&"function"==typeof c&&await c()}catch(o){}w()};r.value.addEventListener("done",k),r.value.onerror=e=>{0===p&&(n.value[d].message="Es ist ein Fehler aufgetreten. Bitte versuchen Sie es später erneut."),w()},r.value.addEventListener("open",(()=>{})),y(),a.value=""}catch(S){o.value=!1,i.value=!1,n.value.length>0&&n.value[n.value.length-1].is_user&&n.value.push({is_user:!1,message:"Fehler bei der Kommunikation mit dem Server. Bitte versuchen Sie es später erneut.",timestamp:Date.now()/1e3})}},sendQuestion:async()=>{if(a.value.trim()&&s.value)try{o.value=!0,d&&(d.value=!0),n.value.push({is_user:!0,message:a.value,timestamp:Date.now()/1e3}),await u(),l();const t={};!0===window.useSimpleLanguage&&(t["X-Use-Simple-Language"]="true");const i=await axios.post("/api/question",{question:a.value,session_id:s.value},{headers:t}),r={id:i.data.message_id,is_user:!1,message:i.data.answer,timestamp:Date.now()/1e3,session_id:s.value};n.value.push(r);try{c&&"function"==typeof c&&await c()}catch(e){}a.value="",await u(),l()}catch(t){n.value.push({is_user:!1,message:"Es ist ein Fehler aufgetreten. Bitte versuchen Sie es später erneut.",timestamp:Date.now()/1e3}),await u(),l()}finally{o.value=!1}},cleanupStream:w}}({token:e,messages:c,question:d,currentSessionId:u,isLoading:g,isStreaming:h,eventSource:k,scrollToBottom:B,nextTick:S,loadSessions:N,motdDismissed:C}),U=function(e){const{messages:t,currentSessionId:n,showFeedbackDialog:a,feedbackComment:s,feedbackMessage:o}=e,i=new Map,r=e=>{if(!e)return!1;if(void 0!==e.feedback_positive)return!0;const t=e.id;return!(!t||!i.has(t))},l=e=>{if(!e)return null;if(void 0!==e.feedback_positive)return e.feedback_positive?"positive":"negative";const t=e.id;return t&&i.has(t)?i.get(t).is_positive?"positive":"negative":null},u=async(e,a,s)=>{var o,r,l,u,c;try{if(await Vue.nextTick(),!e||isNaN(e)||e<=0){const n=t.value.findIndex((e=>!e.is_user&&void 0===e.feedback_positive));if(!(n>=0))return;t.value[n].id||(t.value[n].id=Date.now()),e=t.value[n].id}if(!a||isNaN(a)||a<=0){if(!n||!n.value)return;a=n.value}const d=parseInt(e),g=parseInt(a);await axios.post("/api/feedback",{message_id:d,session_id:g,is_positive:s}),i.set(d,{message_id:d,session_id:g,is_positive:s});const p=t.value.findIndex((e=>e.id===d));if(p>=0)t.value[p].feedback_positive=s,s&&(t.value[p].feedback_comment=null),v("chat-interface-v2")&&m("chat-interface-v2","userSatisfaction",s?1:0,{messageId:d,sessionId:g,messageLength:(null==(r=null==(o=t.value[p])?void 0:o.message)?void 0:r.length)||0});else{const e=null==(l=t.value.map(((e,t)=>({idx:t,isAssistant:!e.is_user}))).filter((e=>e.isAssistant)).pop())?void 0:l.idx;void 0!==e&&(t.value[e].id=d,t.value[e].feedback_positive=s,s&&(t.value[e].feedback_comment=null),v("chat-interface-v2")&&m("chat-interface-v2","userSatisfaction",s?1:0,{messageId:d,sessionId:g,messageLength:(null==(c=null==(u=t.value[e])?void 0:u.message)?void 0:c.length)||0,isFallback:!0}))}}catch(d){alert("Fehler beim Senden des Feedbacks. Bitte versuchen Sie es später erneut.")}},c=async e=>{try{if(!e||isNaN(e)||e<=0)return;const n=await axios.get(`/api/feedback/message/${e}`);if(n.data.feedback){i.set(e,n.data.feedback);const a=t.value.findIndex((t=>t.id===e));a>=0&&(t.value[a].feedback_positive=n.data.feedback.is_positive,t.value[a].feedback_comment=n.data.feedback.comment)}}catch(n){}};return(()=>{window.feedbackHelpers||(window.feedbackHelpers={}),window.feedbackHelpers.isFeedbackGiven=r,window.feedbackHelpers.getFeedbackType=l,window.feedbackHelpers.submitFeedback=u,window.feedbackHelpers.loadMessageFeedback=c;try{Vue.prototype&&(Vue.prototype.$isFeedbackGiven=r,Vue.prototype.$getFeedbackType=l)}catch(e){}})(),{submitFeedback:u,showFeedbackCommentDialog:e=>{if(!e.id&&t.value.findIndex((t=>t===e||t.message===e.message&&!t.is_user))>=0){const t=Date.now();e.id=t}!e.session_id&&n.value&&(e.session_id=n.value),o.value=e,s.value=e.feedback_comment||"",a.value=!0},submitFeedbackComment:async()=>{if(o.value)try{let e=o.value.id,r=o.value.session_id||n.value;if(!e||isNaN(e)||e<=0){const n=t.value.findIndex((e=>!e.is_user&&e.message===o.value.message));e=n>=0&&t.value[n].id?t.value[n].id:Date.now()}await axios.post("/api/feedback",{message_id:e,session_id:r,is_positive:!1,comment:s.value}),i.set(e,{message_id:e,session_id:r,is_positive:!1,comment:s.value});const l=t.value.findIndex((t=>t.id===e));if(l>=0)t.value[l].feedback_comment=s.value,t.value[l].feedback_positive=!1;else{const n=t.value.findIndex((e=>!e.is_user&&e.message===o.value.message));n>=0&&(t.value[n].id=e,t.value[n].feedback_comment=s.value,t.value[n].feedback_positive=!1)}a.value=!1}catch(e){alert("Fehler beim Senden des Feedback-Kommentars. Bitte versuchen Sie es später erneut.")}},loadMessageFeedback:c,isFeedbackGiven:r,getFeedbackType:l}}({messages:c,currentSessionId:u,showFeedbackDialog:I,feedbackComment:E,feedbackMessage:T}),H=s({token:e,userRole:_,isLoading:g}),K=function(){const e=Vue.ref(!1),t=Vue.ref(localStorage.getItem("theme")||"light"),n=Vue.ref(localStorage.getItem("fontSize")||"medium"),a=Vue.ref({reduceMotion:"true"===localStorage.getItem("reduceMotion"),simpleLanguage:"true"===localStorage.getItem("simpleLanguage")}),s=e=>{"Escape"===e.key&&i()},o=e=>{const t=document.querySelector(".settings-panel");!t||t.contains(e.target)||e.target.classList.contains("floating-action-button")||e.target.closest(".floating-action-button")||i()},i=()=>{e.value=!1,document.removeEventListener("keydown",s),document.removeEventListener("click",o)},r=e=>{t.value=e,localStorage.setItem("theme",e),setTimeout((()=>{document.body.classList.remove("theme-light","theme-dark","theme-contrast"),document.body.classList.add(`theme-${e}`),"contrast"===e?document.documentElement.style.setProperty("--focus-ring-color","#ffeb3b"):document.documentElement.style.removeProperty("--focus-ring-color")}),50)},l=e=>{n.value=e,localStorage.setItem("fontSize",e),document.body.classList.remove("font-small","font-medium","font-large"),"medium"!==e&&document.body.classList.add(`font-${e}`)},u=t=>{const n={...a.value,...t};"reduceMotion"in t&&t.reduceMotion!==a.value.reduceMotion&&t.reduceMotion&&(document.removeEventListener("click",o),document.removeEventListener("keydown",s),setTimeout((()=>{e.value&&(document.addEventListener("click",o),document.addEventListener("keydown",s))}),100)),a.value=n;for(const[e,s]of Object.entries(a.value))localStorage.setItem(e,s);a.value.reduceMotion?document.body.classList.add("reduce-motion"):document.body.classList.remove("reduce-motion"),"simpleLanguage"in t&&c(t.simpleLanguage)},c=e=>{window.useSimpleLanguage=e;const t=new CustomEvent("simpleLanguageChanged",{detail:{enabled:e}});document.dispatchEvent(t),e?axios&&axios.defaults&&axios.defaults.headers&&(axios.defaults.headers.common["X-Use-Simple-Language"]="true"):axios&&axios.defaults&&axios.defaults.headers&&delete axios.defaults.headers.common["X-Use-Simple-Language"]};return r(t.value),l(n.value),a.value.reduceMotion&&document.body.classList.add("reduce-motion"),window.useSimpleLanguage=a.value.simpleLanguage,a.value.simpleLanguage&&axios&&axios.defaults&&axios.defaults.headers&&(axios.defaults.headers.common["X-Use-Simple-Language"]="true"),Vue.watch((()=>t.value),(e=>{r(e)})),Vue.watch((()=>n.value),(e=>{l(e)})),Vue.watch((()=>a.value.reduceMotion),((e,t)=>{e!==t&&u({reduceMotion:e})})),Vue.watch((()=>a.value.simpleLanguage),((e,t)=>{e!==t&&u({simpleLanguage:e})})),{showSettingsPanel:e,currentTheme:t,currentFontSize:n,accessibilitySettings:a,toggleSettings:()=>{e.value=!e.value,e.value?(document.addEventListener("keydown",s),setTimeout((()=>{document.addEventListener("click",o)}),100)):(document.removeEventListener("keydown",s),document.removeEventListener("click",o))},closeSettingsPanel:i,setTheme:r,setFontSize:l,updateAccessibilitySettings:u}}(),q=function(e){const{messages:t}=e,n=Vue.ref(!1),a=Vue.ref(null),s=Vue.ref(!1),o=Vue.ref(!1),i=Vue.ref({title:"",text:"",sourceId:""}),r=Vue.ref({top:0,left:0}),l=async e=>{if(!e||!e.id)return n.value=!0,void(a.value={original_question:"Keine Frage gefunden",explanation_text:"Diese Nachricht kann nicht erklärt werden, da keine gültige ID vorhanden ist.",source_references:[]});try{s.value=!0,n.value=!0;const t=await axios.get(`/api/explain/${e.id}`,{timeout:1e4});a.value=t.data}catch(t){a.value={original_question:e.message,answer_summary:"Keine Erklärung verfügbar",source_references:[],explanation_text:"Es ist ein Fehler bei der Erklärung aufgetreten. Möglicherweise stehen für diese Antwort keine Quellen zur Verfügung."}}finally{s.value=!1}},u=e=>{l(e)},c=()=>{n.value=!1,setTimeout((()=>{a.value=null}),300)},d=()=>"\n            .source-reference {\n                display: inline-block;\n                padding: 0 2px;\n                border-radius: 4px;\n                font-size: 0.9em;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n            .source-reference:hover {\n                transform: translateY(-1px);\n            }\n            \n            .source-buttons {\n                display: flex;\n                margin-top: 12px;\n                gap: 10px;\n            }\n            \n            .source-btn {\n                display: inline-flex;\n                align-items: center;\n                padding: 6px 12px;\n                border-radius: 4px;\n                font-size: 0.85rem;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n            \n            .source-btn i {\n                margin-right: 6px;\n            }\n            \n            /* Quellen-Popup */\n            .source-popup {\n                position: absolute;\n                background-color: white;\n                border-radius: 6px;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                padding: 12px;\n                max-width: 300px;\n                z-index: 1000;\n                animation: fadeIn 0.2s ease-out;\n            }\n            \n            @keyframes fadeIn {\n                from { opacity: 0; transform: translateY(-5px); }\n                to { opacity: 1; transform: translateY(0); }\n            }\n            \n            .source-popup-title {\n                font-weight: 600;\n                margin-bottom: 8px;\n                padding-bottom: 8px;\n                border-bottom: 1px solid #eaeaea;\n            }\n            \n            .source-popup-content {\n                font-size: 0.9rem;\n                line-height: 1.5;\n                max-height: 200px;\n                overflow-y: auto;\n                margin-bottom: 10px;\n            }\n            \n            .source-popup-file {\n                font-size: 0.8rem;\n                color: #666;\n                margin-bottom: 10px;\n            }\n            \n            .source-popup-close {\n                display: block;\n                text-align: right;\n                font-size: 0.85rem;\n                color: #666;\n                cursor: pointer;\n                margin-top: 8px;\n            }\n            \n            .source-popup-close:hover {\n                color: #333;\n                text-decoration: underline;\n            }\n        "+(document.body.classList.contains("theme-dark")?"\n                .source-reference {\n                    background-color: rgba(0, 192, 96, 0.2);\n                    border: 1px solid rgba(0, 192, 96, 0.3);\n                    color: #00c060;\n                }\n                .source-reference:hover {\n                    background-color: rgba(0, 192, 96, 0.3);\n                }\n                .source-btn {\n                    background-color: #1e1e1e;\n                    border: 1px solid #333;\n                    color: #f0f0f0;\n                }\n                .source-btn:hover {\n                    background-color: #333;\n                }\n                \n                .source-popup {\n                    background-color: #1e1e1e;\n                    border: 1px solid #333;\n                    color: #f0f0f0;\n                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                }\n                \n                .source-popup-title {\n                    border-bottom-color: #333;\n                    color: #00c060;\n                }\n                \n                .source-popup-file {\n                    color: #aaa;\n                }\n                \n                .source-popup-close {\n                    color: #aaa;\n                }\n                \n                .source-popup-close:hover {\n                    color: #fff;\n                }\n            ":document.body.classList.contains("theme-contrast")?"\n                    .source-reference {\n                        background-color: #333300;\n                        border: 1px solid #ffeb3b;\n                        color: #ffeb3b;\n                        font-weight: bold;\n                    }\n                    .source-reference:hover {\n                        background-color: #444400;\n                    }\n                    .source-btn {\n                        background-color: #000000;\n                        border: 1px solid #ffeb3b;\n                        color: #ffeb3b;\n                    }\n                    .source-btn:hover {\n                        background-color: #333300;\n                    }\n                    \n                    .source-popup {\n                        background-color: #000000;\n                        border: 2px solid #ffeb3b;\n                        color: #ffffff;\n                        box-shadow: 0 4px 12px rgba(255, 235, 59, 0.2);\n                    }\n                    \n                    .source-popup-title {\n                        border-bottom-color: #ffeb3b;\n                        color: #ffeb3b;\n                    }\n                    \n                    .source-popup-file {\n                        color: #ffeb3b;\n                    }\n                    \n                    .source-popup-close {\n                        color: #ffeb3b;\n                    }\n                    \n                    .source-popup-close:hover {\n                        color: #ffffff;\n                    }\n                ":"\n                    .source-reference {\n                        background-color: rgba(0, 165, 80, 0.1);\n                        border: 1px solid rgba(0, 165, 80, 0.2);\n                        color: #008d45;\n                    }\n                    .source-reference:hover {\n                        background-color: rgba(0, 165, 80, 0.2);\n                    }\n                    .source-btn {\n                        background-color: #f8f9fa;\n                        border: 1px solid #e2e8f0;\n                        color: #4a5568;\n                    }\n                    .source-btn:hover {\n                        background-color: #edf2f7;\n                    }\n                ");return(()=>{const e=document.createElement("style");e.id="source-references-styles",e.innerHTML=d(),document.head.appendChild(e),new MutationObserver((e=>{e.forEach((e=>{if("class"===e.attributeName&&e.target===document.body){const e=document.getElementById("source-references-styles");e&&(e.innerHTML=d())}}))})).observe(document.body,{attributes:!0})})(),window.loadExplanation=l,window.showSourcesDialog=u,window.closeExplanationDialog=c,window.showSourcePopupHandler=(e,n)=>{const l=e.target.getBoundingClientRect();r.value={top:l.bottom+window.scrollY,left:l.left+window.scrollX};const u=t.value.find((e=>!e.is_user&&e.message.includes(`Quelle-${n}`)));u?(s.value=!0,o.value=!0,i.value={title:`Quelle ${n}`,text:"Lade Quelleninformationen...",sourceId:n},(async()=>{try{if(a.value&&a.value.source_references){const e=a.value.source_references.find((e=>e.source_id===`Quelle-${n}`));if(e)return void(i.value={title:`${e.source_id}`,text:e.preview||"Keine Vorschau verfügbar",file:e.file,sourceId:n})}if(u.id){const e=await axios.get(`/api/explain/${u.id}`);a.value=e.data;const t=a.value.source_references.find((e=>e.source_id===`Quelle-${n}`));i.value=t?{title:`${t.source_id}`,text:t.preview||"Keine Vorschau verfügbar",file:t.file,sourceId:n}:{title:`Quelle ${n}`,text:"Keine detaillierten Informationen verfügbar",sourceId:n}}else i.value={title:`Quelle ${n}`,text:"Keine detaillierten Informationen verfügbar",sourceId:n}}catch(e){i.value={title:`Quelle ${n}`,text:"Fehler beim Laden der Quelleninformationen",sourceId:n}}finally{s.value=!1}})()):(i.value={title:`Quelle ${n}`,text:"Keine detaillierten Informationen verfügbar",sourceId:n},o.value=!0)},window.closeSourcePopup=()=>{o.value=!1},{hasSourceReferences:e=>!!e&&(/\(Quelle-\d+\)/.test(e)||/Dokument \d+/.test(e)||/Quelle(n)?:/.test(e)||/Abschnitt/.test(e)||/aus nscale/.test(e)),extractSourceReferences:e=>{if(!e)return[];const t=[/\(Quelle-(\d+)\)/g,/Dokument (\d+)/g,/Abschnitt ['"]([^'"]+)['"]/g];let n=[];for(const a of t){const t=[...e.matchAll(a)||[]];if(t.length>0){const e=t.map((e=>e[1]));n=[...n,...e]}}return 0===n.length&&/Quelle(n)?:/.test(e)&&n.push("Quellenabschnitt"),[...new Set(n)]},formatMessageWithSourceHighlighting:e=>{if(!e)return"";let t=e;return t=t.replace(/\(Quelle-(\d+)\)/g,'<span class="source-reference" data-source-id="$1" onclick="window.showSourcePopupHandler(event, \'$1\')" title="Klicken für Details zu Quelle $1">$&</span>'),t=t.replace(/(Dokument \d+) \(([^\)]+)\)/g,'<span class="source-reference" data-document-name="$2" onclick="window.showSourcePopupHandler(event, \'doc-$2\')" title="Klicken für Details zu $2">$1</span>'),t},loadExplanation:l,showSourcesDialog:u,closeExplanationDialog:c,renderExplanationDialog:()=>n.value?`\n            <div class="modal-overlay">\n                <div class="modal-container max-w-3xl">\n                    <div class="modal-header">\n                        <h3 class="modal-title">Antwort-Erklärung</h3>\n                        <button class="modal-close" onclick="window.closeExplanationDialog()">×</button>\n                    </div>\n                    <div class="modal-body overflow-y-auto max-h-[70vh]">\n                        ${s.value?'\n                <div class="p-4 text-center">\n                    <div class="loader mx-auto mb-3"></div>\n                    <p>Erklärung wird geladen...</p>\n                </div>\n            ':a.value?`\n                    <div class="p-6">\n                        <div class="mb-4">\n                            <h3 class="font-medium text-lg mb-2">Ursprüngliche Frage:</h3>\n                            <p class="p-2 bg-gray-50 rounded">${a.value.original_question}</p>\n                        </div>\n                        \n                        <div class="mb-4">\n                            <h3 class="font-medium text-lg mb-2">Verwendete Quellen:</h3>\n                            <div class="p-3 bg-gray-50 rounded">\n                                ${a.value.source_references&&a.value.source_references.length?a.value.source_references.map(((e,t)=>`\n                                        <div class="mb-2 pb-2 ${t<a.value.source_references.length-1?"border-b border-gray-200":""}">\n                                            <div class="flex justify-between">\n                                                <span class="font-medium">${e.source_id}</span>\n                                                <span class="text-sm text-gray-500">${e.usage_count||0}× verwendet</span>\n                                            </div>\n                                            <p class="text-sm">Datei: ${e.file}</p>\n                                            ${e.title?`<p class="text-sm">Abschnitt: ${e.title}</p>`:""}\n                                            <div class="mt-1 text-xs bg-white p-2 rounded border border-gray-200">\n                                                ${e.preview||"Keine Vorschau verfügbar"}\n                                            </div>\n                                        </div>\n                                    `)).join(""):'<p class="text-sm text-gray-500">Keine Quellen gefunden.</p>'}\n                            </div>\n                        </div>\n                        \n                        <div class="mt-4">\n                            <h3 class="font-medium text-lg mb-2">Erläuterung:</h3>\n                            <div class="p-3 bg-gray-50 rounded whitespace-pre-line">\n                                ${a.value.explanation_text||"Keine Erläuterung verfügbar."}\n                            </div>\n                        </div>\n                    </div>\n                `:'\n                    <div class="p-4 text-center">\n                        <p>Keine Erklärungsdaten verfügbar.</p>\n                    </div>\n                '}\n                    </div>\n                    <div class="modal-footer">\n                        <button class="nscale-btn-secondary" onclick="window.closeExplanationDialog()">Schließen</button>\n                    </div>\n                </div>\n            </div>\n        `:"",renderSourcePopup:()=>o.value?`\n            <div class="source-popup" style="top: ${r.value.top}px; left: ${r.value.left}px;">\n                <div class="source-popup-title">${i.value.title}</div>\n                ${i.value.file?`<div class="source-popup-file">Datei: ${i.value.file}</div>`:""}\n                <div class="source-popup-content">${i.value.text}</div>\n                <div class="source-popup-close" onclick="window.closeSourcePopup()">Schließen</div>\n            </div>\n        `:"",showExplanationDialog:n,showSourcePopup:o,currentExplanation:a,explanationLoading:s,debugSourceReferences:e=>{}}}({messages:c}),{toggleSettings:J}=K,W=async()=>{try{const e=await axios.get("/api/motd");if(D.value=e.data,D.value&&D.value.style){let e=!1;for(const[t,n]of Object.entries(L))if(n.backgroundColor===D.value.style.backgroundColor){$.value=t,e=!0;break}e||($.value="custom")}}catch(e){}};return window.addEventListener("beforeunload",(()=>{u.value&&(A(u.value),V(u.value))})),w((async()=>{O(),window.telemetry&&"function"==typeof window.telemetry.init&&window.telemetry.init(),p(),e.value&&(await N(),await H.loadUserRole(),await M()),W(),window.reloadCurrentSession=Q,window.updateSessionTitle=P,window.updateAllSessionTitles=z,setInterval((async()=>{e.value&&"chat"===x.value&&await N()}),1e4),setInterval((async()=>{if(e.value&&"chat"===x.value&&u.value&&window.updateSessionTitle&&"function"==typeof window.updateSessionTitle)try{await window.updateSessionTitle(u.value)}catch(t){}}),3e4),y(e,(e=>{e?H.loadUserRole():(c.value=[],u.value=null,_.value="user",x.value="chat",localStorage.removeItem("lastActiveSession"))})),y(a,(()=>{i.value="",r.value=""})),window.addEventListener("beforeunload",(()=>{k.value&&k.value.close()})),window.loadMotd=W})),{token:e,email:t,password:n,authMode:a,loading:o,errorMessage:i,successMessage:r,login:async()=>{var a,s;try{o.value=!0,i.value="";const a=await axios.post("/api/auth/login",{email:t.value,password:n.value});e.value=a.data.token,localStorage.setItem("token",e.value),O(),t.value="",n.value="",await H.loadUserRole(),N()}catch(r){i.value=(null==(s=null==(a=r.response)?void 0:a.data)?void 0:s.detail)||"Anmeldefehler. Bitte versuchen Sie es erneut."}finally{o.value=!1}},register:async()=>{var e,s;try{o.value=!0,i.value="",await axios.post("/api/auth/register",{email:t.value,password:n.value}),a.value="login",r.value="Registrierung erfolgreich. Bitte melden Sie sich an.",t.value="",n.value=""}catch(l){i.value=(null==(s=null==(e=l.response)?void 0:e.data)?void 0:s.detail)||"Registrierungsfehler. Bitte versuchen Sie es erneut."}finally{o.value=!1}},resetPassword:async()=>{var e,n;try{o.value=!0,i.value="",r.value="";const e=await axios.post("/api/auth/reset-password",{email:t.value});r.value=e.data.message,e.data.token&&(r.value+=` Token: ${e.data.token}`)}catch(a){i.value=(null==(n=null==(e=a.response)?void 0:e.data)?void 0:n.detail)||"Fehler beim Zurücksetzen des Passworts."}finally{o.value=!1}},logout:()=>{u.value&&V(u.value),e.value="",localStorage.removeItem("token"),O(),u.value=null,l.value=[],c.value=[],_.value="user",x.value="chat",localStorage.removeItem("lastActiveSession"),k.value&&(k.value.close(),k.value=null)},activeView:x,sessions:l,currentSessionId:u,messages:c,question:d,isLoading:g,chatMessages:f,isStreaming:h,loadSessions:N,loadSession:F,startNewSession:async()=>{try{C.value=!1,localStorage.removeItem("motdDismissed"),g.value=!0;const e=await axios.post("/api/session",{title:"Neue Unterhaltung"});await N(),await F(e.data.session_id),x.value="chat"}catch(e){}finally{g.value=!1}},deleteSession:async e=>{if(confirm("Möchten Sie diese Unterhaltung wirklich löschen?"))try{await axios.delete(`/api/session/${e}`),u.value===e&&(u.value=null,c.value=[],localStorage.removeItem("lastActiveSession")),await N()}catch(t){}},formatMessage:R,scrollToBottom:B,saveCurrentSessionToStorage:A,restoreLastActiveSession:M,...j,...U,showFeedbackDialog:I,feedbackComment:E,...H,userRole:_,getAdminTabTitle:()=>{switch(H.adminTab.value){case"users":return"Benutzerverwaltung";case"system":return"Systemüberwachung";case"feedback":return"Feedback-Analyse";case"motd":return"Message of the Day";case"abtests":return"A/B-Tests";default:return"Administration"}},toggleView:()=>{J()},toggleAdminView:()=>{"admin"===_.value&&(x.value="chat"===x.value?"admin":"chat")},...K,...q,formatMessageWithSources:e=>{if(!e)return"";if(q.hasSourceReferences(e)){const t=q.formatMessageWithSourceHighlighting(e);return marked.parse(t)}return R(e)},motd:D,motdDismissed:C,loadMotd:W,dismissMotd:()=>{C.value=!0,localStorage.setItem("motdDismissed","true")},formatMotdContent:e=>e?e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n\n/g,"<br/><br/>").replace(/\n-\s/g,"<br/>• "):"",selectedColorTheme:$,applyColorTheme:()=>{if("custom"!==$.value&&L[$.value]){const e=L[$.value];motdConfig.value.style.backgroundColor=e.backgroundColor,motdConfig.value.style.borderColor=e.borderColor,motdConfig.value.style.textColor=e.textColor}},updateSessionTitle:P,updateAllSessionTitles:z,reloadCurrentSession:Q}}}).mount("#app"),document.addEventListener("DOMContentLoaded",(()=>{k()})),window.initializeVueComponents=k,window.initDocConverter=x;
