var e,a;function t(e){const{token:a,userRole:t,isLoading:n}=e,i=Vue.ref(!1),l=Vue.ref("users"),r=Vue.ref([]),s=Vue.ref({email:"",password:"",role:"user"}),d=Vue.ref({}),o=Vue.ref({}),u=Vue.ref([]),c=Vue.ref([]),v=Vue.ref(null),m=Vue.ref({enabled:!0,format:"markdown",content:"",style:{backgroundColor:"#fff3cd",borderColor:"#ffeeba",textColor:"#856404",iconClass:"info-circle"},display:{position:"top",dismissible:!0,showOnStartup:!1,showInChat:!0}});Vue.watch((()=>l.value),(e=>{"users"===e?f():"system"===e?h():"feedback"===e?(g(),w()):"motd"===e?p():"abtests"===e&&b()}));const f=async()=>{var e,a;try{if("admin"===t.value){n.value=!0;const e=await axios.get("/api/admin/users");e.data.users&&e.data.users.length>0?r.value=e.data.users:r.value=[]}}catch(i){i.response&&403===i.response.status?alert("Sie haben keine Berechtigung für diese Aktion."):alert("Fehler beim Laden der Benutzerliste: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},h=async()=>{var e,a;try{if("admin"===t.value){n.value=!0;const e=await axios.get("/api/admin/stats");d.value=e.data.stats}}catch(i){alert("Fehler beim Laden der Systemstatistiken: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},g=async()=>{var e,a;try{if("admin"===t.value){n.value=!0;const e=await axios.get("/api/admin/feedback/stats");o.value=e.data.stats}}catch(i){alert("Fehler beim Laden der Feedback-Statistiken: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},w=async()=>{var e,a;try{if("admin"===t.value){n.value=!0;const e=await axios.get("/api/admin/feedback/negative");u.value=e.data.feedback}}catch(i){alert("Fehler beim Laden des negativen Feedbacks: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},p=async()=>{var e,a;try{if("admin"===t.value){n.value=!0;const e=await axios.get("/api/motd");m.value=JSON.parse(JSON.stringify(e.data))}}catch(i){alert("Fehler beim Laden der MOTD-Konfiguration: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},b=()=>{try{if("admin"===t.value)if(n.value=!0,window.abTesting&&window.abTesting.listAvailableTests){const e=window.abTesting.listAvailableTests();c.value=e.map((e=>({...e,currentVariant:window.abTesting.getUserTestVariant(e.id)||"Nicht zugewiesen"})))}else c.value=[]}catch(e){alert("Fehler beim Laden der A/B-Tests: "+e.message)}finally{n.value=!1}};return{userRole:t,showAdminPanel:i,adminTab:l,adminUsers:r,newUser:s,systemStats:d,feedbackStats:o,negativeFeedback:u,motdConfig:m,currentUserId:v,abTests:c,loadUserRole:async()=>{try{if(a.value){const e=await axios.get("/api/user/role");t.value=e.data.role,e.data.user_id&&(v.value=e.data.user_id),"admin"===t.value&&await f()}}catch(e){t.value="user"}},loadUsers:f,createUser:async()=>{var e,a;try{if("admin"===t.value){if(!s.value.email||!s.value.password)return void alert("Bitte füllen Sie alle Pflichtfelder aus.");n.value=!0,await axios.post("/api/admin/users",s.value),await f(),alert(`Benutzer ${s.value.email} wurde erfolgreich erstellt.`),s.value={email:"",password:"",role:"user"}}}catch(i){i.response&&400===i.response.status?alert("Benutzer existiert bereits oder ungültige Daten."):alert("Fehler beim Erstellen des Benutzers: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},updateUserRole:async(e,a)=>{var i,l;try{if("admin"===t.value){if(e===v.value)return alert("Sie können Ihre eigene Rolle nicht ändern."),void(await f());n.value=!0,await axios.put(`/api/admin/users/${e}/role`,{role:a}),alert(`Die Rolle des Benutzers wurde auf ${a} aktualisiert.`),await f()}}catch(r){alert("Fehler beim Aktualisieren der Benutzerrolle: "+((null==(l=null==(i=r.response)?void 0:i.data)?void 0:l.detail)||r.message)),await f()}finally{n.value=!1}},deleteUser:async e=>{try{if("admin"===t.value){if(e===v.value)return void alert("Sie können Ihr eigenes Konto nicht löschen.");const a=r.value.find((a=>a.id===e));if(a&&"admin"===a.role)return void alert("Administratoren können nicht gelöscht werden.");if(!confirm("Möchten Sie diesen Benutzer wirklich löschen?"))return;n.value=!0,await axios.delete(`/api/admin/users/${e}`),alert("Benutzer wurde erfolgreich gelöscht."),await f()}}catch(a){a.response?400===a.response.status?alert("Der Benutzer kann nicht gelöscht werden: "+a.response.data.detail):403===a.response.status?alert("Sie haben keine Berechtigung zum Löschen dieses Benutzers."):alert("Fehler beim Löschen des Benutzers: "+(a.response.data.detail||a.message)):alert("Fehler beim Löschen des Benutzers: "+a.message)}finally{n.value=!1}},loadSystemStats:h,loadFeedbackStats:g,loadNegativeFeedback:w,reloadMotd:async()=>{var e,a;try{"admin"===t.value&&(n.value=!0,await axios.post("/api/admin/reload-motd"),"function"==typeof window.loadMotd&&await window.loadMotd(),alert("MOTD wurde erfolgreich neu geladen"))}catch(i){alert("Fehler beim Neuladen der MOTD: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},clearModelCache:async()=>{var e,a;try{if("admin"===t.value&&confirm("Möchten Sie wirklich den Modell-Cache leeren?")){n.value=!0;const e=await axios.post("/api/admin/clear-cache");alert(e.data.message||"Cache wurde geleert")}}catch(i){alert("Fehler beim Leeren des Caches: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},clearEmbeddingCache:async()=>{var e,a;try{"admin"===t.value&&confirm("Möchten Sie wirklich den Embedding-Cache leeren?")&&(n.value=!0,await axios.post("/api/admin/clear-embedding-cache"),alert("Embedding-Cache wurde erfolgreich geleert"))}catch(i){alert("Fehler beim Leeren des Embedding-Caches: "+((null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message))}finally{n.value=!1}},loadMotdConfig:p,resetMotdConfig:()=>{confirm("Möchten Sie die MOTD-Konfiguration wirklich zurücksetzen?")&&(m.value={enabled:!0,format:"markdown",content:"🛠️ **BETA-VERSION: Lokaler KI-Assistent für nscale**\n\nDieser Assistent beantwortet Fragen zur Nutzung der nscale DMS-Software auf Basis interner Informationen.\n\n🔒 **Wichtige Hinweise:**\n- Alle Datenverarbeitungen erfolgen **ausschließlich lokal im Landesnetz Berlin**.\n- Es besteht **keine Verbindung zum Internet** – Ihre Eingaben verlassen niemals das System.\n- **Niemand außer Ihnen** hat Zugriff auf Ihre Eingaben oder Fragen.\n- Die Antworten werden von einer KI generiert – **Fehlinformationen sind möglich**.\n- Bitte geben Sie **keine sensiblen oder personenbezogenen Daten** ein.\n\n🧠 Der Assistent befindet sich in der Erprobung und wird stetig weiterentwickelt.",style:{backgroundColor:"#fff3cd",borderColor:"#ffeeba",textColor:"#856404",iconClass:"info-circle"},display:{position:"top",dismissible:!0,showOnStartup:!1,showInChat:!0}})},saveMotdConfig:async()=>{var e,a;try{if("admin"===t.value){if(n.value=!0,!m.value.content.trim())return alert("Der MOTD-Inhalt darf nicht leer sein."),void(n.value=!1);await axios.post("/api/admin/update-motd",m.value),"function"==typeof window.loadMotd&&await window.loadMotd(),alert("MOTD-Konfiguration erfolgreich gespeichert!")}}catch(i){alert(`Fehler beim Speichern: ${(null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.detail)||i.message}`)}finally{n.value=!1}},formatMotdContent:e=>e?e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n\n/g,"<br/><br/>").replace(/\n-\s/g,"<br/>• "):"",loadABTests:b}}e="admin",a="initialize",void 0!==window.telemetry&&window.telemetry.trackEvent("legacy_code_usage",{component:e,action:a,timestamp:(new Date).toISOString()});export{t as s};
